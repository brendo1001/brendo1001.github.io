<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Customising public digital soil mapping products with mass preserving splines &#8211; Smart Digital Agriculture</title>
<meta name="description" content="My own original content">


<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="Customising public digital soil mapping products with mass preserving splines">
<meta name="twitter:description" content="My own original content">
<meta name="twitter:creator" content="@soilmalone">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Customising public digital soil mapping products with mass preserving splines">
<meta property="og:description" content="My own original content">
<meta property="og:url" content="/UseCases/Writings/gridsplines/">
<meta property="og:site_name" content="Smart Digital Agriculture">

<meta name="google-site-verification" content="googledd99b1430269a639.html">



<link rel="canonical" href="/UseCases/Writings/gridsplines/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Smart Digital Agriculture Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="/assets/css/bootstrap.min.css">
<!-- Clean Blog CSS -->
<link rel="stylesheet" href="/assets/css/clean-blog.css">
<!-- HPSTR main CSS -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Custom Fonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Viga|Ubuntu:700' rel='stylesheet' type='text/css'>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

</head>

<body id="page" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Smart Digital Agriculture</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    
                    <li><a href="/" >Home</a></li>
                
                    
                    <li><a href="/publications/" >Publications</a></li>
                
                    
                    <li><a href="/software/" >Software</a></li>
                
                    
                    <li><a href="/blog/" >Journal Digests</a></li>
                
                    
                    <li><a href="/UseCases/" >Blog</a></li>
                
                    
                    <li><a href="/DSM_book/" >Using R for Digital Soil Mapping</a></li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Page Header -->
<header class="intro-header" style="background-image: url('/images/worldSoilDay.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
                    <h1>Customising public digital soil mapping products with mass preserving splines</h1>
                    
                        <hr class="small">
                        <span class="subheading">My own original content</span>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<!--

-->

<div id="main" role="main">
  <article class="hentry">
    <!--
    <header class="header-title">
      <div class="header-title-wrap">
        <h1 class="entry-title">Customising public digital soil mapping products with mass preserving splines</h1>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~15 minutes
        </p>
        
      </div>
    </header>
    -->
    <div class="entry-content">
      <p><em>There are now plenty of soil maps which digitally represent the soil variation across landscapes in both the lateral and vertical dimensions. Some might say this is akin to digital twinning for natural resources. These representations are usually provided as depth slices or layers for specified depth intervals. What is probably not as widely known or practiced is that one can use these data to generate custom soil maps (in terms of vertical support representation) according to the wishes of the end-user or map maker. In this post, the mass-preserving spline is re-introduced not for harmonising soil profile data, but for creating user-defined soil maps that exploit 3D digital soil mapping information that are becoming widely available publicly and for free.</em></p>

<h3 id="a-background-story-of-sorts">A background story of sorts</h3>

<p>There do not appear to be new official global activities associated with the <a href="https://www.isric.org/projects/globalsoilmapnet">GlobalSoilMap.net</a> project (Sanchez et al. 2009) any longer. This initiative was very active between 2009 and 2013 and created a flurry of efforts to map the world’s soils and their characteristics. The initial philosophy of GlobalSoilMap.net was for nodes to coordinate activities across a selected number of regions and individual countries would work within the nodes to develop digital soil mapping products for within country, and provide assistance to other countries in the region where the necessary digital soil mapping skill base was still in development.</p>

<p>Probably the greatest success and lasting legacy of the GlobalSoilMap.net project was the creation of a document that specified the expected outputs to be developed i.e. the GlobalSoilMap.net specifications (Arrouays et al. 2014). These specifications have guided digital soil mapping practices throughout the world since they were published. Global soil mapping efforts now are coordinated a little differently and mainly through the auspices of the <a href="http://www.fao.org/global-soil-partnership/en/">Global Soil Parntership</a>. One of the main GlobalSoilMap.net specifications was the requirement to produce maps for the following soil properties: SOC, clay, silt, sand and coarse fragment contents, pH, ECEC, soil depth and available depth to rooting, bulk density (whole soil and fine earth fraction), and available water capacity at standard depths to 2m. Specifically for the depth intervals of: 0-5cm, 5-15cm, 15-30cm, 30-60cm, 60-100cm, 100-200cm.</p>

<p>Early research was dedicated to figuring out approaches for generating digital maps for the specified standard depths given legacy soil profile data and the existing digital soil mapping techniques. The mass preserving spline (Bishop, McBratney, and Laslett 1999) became a critical methodological advancement in this regard as it enabled soil profile data all with disparate depth information to be harmonised. The spline was fitted to the soil profile data and this depth function is then integrated to get the target soil property values for the standard depths or any specified depth intervals or set of depth intervals according to the user. The mass preserving spline is super useful and its mass preserving properties mean that the original soil profile information is never lost after the function is fitted. In a digital soil mapping context, first soil profile data is gathered, the splines are fitted individually to each profile from which the soil target variables at each standard depth is retrieved. Then spatial models are fitted for each depth using a collected suite of environmental covariate layers as predictor variables. This is the general approach undertaken in Malone et al. (2009) which has also been done too throughout the world. While this approach remains popular, different 3D spatial modelling approaches have evolved (see for example Hengl (2017), Orton, Pringle, and Bishop (2016), Viscarra Rossel et al. (2015), and Poggio and Gimona (2014)). But ultimately, the end result from whatever approach is used are digital soil maps of specific variables at each standard depth. The depth support of these maps is supposedly representing an average of the specified target variable for the given standard depth. This is the case for the Malone et al., Orton et al., Viscarra Rossel et al. and Poggio and Gimona approaches, but likely not for the Hengl et al. approach where the values are indicative of the mid-point between the upper and lower depths standard intervals. Technical differences aside, most maps are generated at a point support for a specified grid cell or pixel resolution which for the global soil mapping specifications was ~90m on the basis of the 3-sec STRM DEM which became readily available around the same time as the launching of GlobalSoilMap.</p>

<p>So there is now seemingly a proliferation of digital soil maps covering all parts of the world, all produced in a way that meet or closely adhere to the specifications set out in Arrouays et al. (2014). Australia is one of these places, and the efforts are described in Grundy et al. (2015). The great thing about this effort (The Soil and Landscape Grid of Australia; SLGA) is now these data are available for everyone to retrieve and importantly use for any number of purposes that requires spatial soil information. <a href="https://www.clw.csiro.au/aclep/soilandlandscapegrid/GetData-DAP.html#">This data is easy to access and download</a>. If one is an <code class="highlighter-rouge">R</code> user there is now even a package, <a href="https://cran.r-project.org/web/packages/slga/index.html">slga</a> that facilitates easy access and download of specified soil and environment data. We will get onto more of this package later.</p>

<h3 id="an-opportunity">An opportunity</h3>

<p>How to make use of the available digital soil maps poses some follow up questions. It is great to be able to have a 3-D digital representation of soils, in some ways akin to a digital twin. But without necessary tools with which to analyse the representations of these data i.e. interrogating and integrating the 0-5cm,5-15cm, 15-30cm, 30-60cm, 60-100cm, and 100-200cm layers, one will be limited in realising the utility of this information. One tool to be described in this post is the mass-preserving spline which we were just introduced to earlier in regards to harmonising soil profile data. Essentially the soil target variable data together with information about corresponding depths intervals are parameters of the spline. Therefore where there is layered and gridded digital soil maps we basically can fit a spline at each grid cell and then interrogate the fitted spline to generate new outputs at a different vertical support. This allows one to customise their soil mapping information to a form that is conducive for their own particular analysis. Furthermore a step forwards on this is that one can facilitate inferences as was exemplified in Malone et al. (2009) where variables such as depth to which carbon stocks breached a given threshold value, or estimated the water holding capacity to a given depth etc. One can even get more sophisticated around inference for such things as detecting depth to a texture contrast layer or to some given soil constraint. The important key point here is that the layered 3D representation of soil information as specified for GlobalSoilMap or for any other similar product, is that there is added utility of this information beyond the base maps.</p>

<p>This post intends to exemplify the splines approach for 3D soil mapping products using the the SLGA data and associated R package as the vehicle for doing this. At the moment the code for doing this comes from a bespoke R function called <code class="highlighter-rouge">ea_ras_func</code> and can be download from <a href="https://www.dropbox.com/s/0rmrsfl6pk7p9gj/ea_ras_func.R?dl=0">here</a>. For all intents and purposes the function is the same as would be used to fit to soil profile data but is streamlined for grid data. Another key point is that as there are no gaps between sol values as the layers are adjacent to one another, there is no interpolation, meaning that the mass-preserving properties of the spline are much easier to adhere to.</p>

<h3 id="lets-get-on-with-it">Let’s get on with it</h3>

<p>To get a bit more background about the <a href="https://cran.r-project.org/web/packages/slga/index.html">slga</a><code class="highlighter-rouge">R</code> package it is worth checking out the vignette that comes with the package that you can open once it is installed. This package is available from <a href="https://cran.r-project.org/">CRAN</a>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"slga"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Load the <code class="highlighter-rouge">R</code> packages required and the function for spline fitting.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># The grid spline function</span><span class="w">
</span><span class="n">source</span><span class="p">(</span><span class="s2">"ea_ras_func.R"</span><span class="p">)</span><span class="w">

</span><span class="c1"># R libraries</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">slga</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The next bits of code are for download of the SLGA maps. This is pretty much verbatim what is done in the slga <code class="highlighter-rouge">R</code> package vignette.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Get surface clay content for King Island</span><span class="w">

</span><span class="c1"># Area of interest (aka bounding box)</span><span class="w">
</span><span class="n">aoi</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">149.00</span><span class="p">,</span><span class="w"> </span><span class="m">-35.50</span><span class="p">,</span><span class="w"> </span><span class="m">149.1</span><span class="p">,</span><span class="w"> </span><span class="m">-35.40</span><span class="p">)</span><span class="w">

</span><span class="c1"># Get the data</span><span class="w">
</span><span class="n">s</span><span class="m">1</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stack</span><span class="p">()</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">6</span><span class="p">){</span><span class="w">
    </span><span class="n">r</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">get_soils_data</span><span class="p">(</span><span class="n">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'NAT'</span><span class="p">,</span><span class="w"> </span><span class="n">attribute</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'CLY'</span><span class="p">,</span><span class="w"> </span><span class="n">component</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'VAL'</span><span class="p">,</span><span class="w"> </span><span class="n">depth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">aoi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aoi</span><span class="p">,</span><span class="w"> </span><span class="n">write_out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
    </span><span class="n">s</span><span class="m">1</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stack</span><span class="p">(</span><span class="n">s</span><span class="m">1</span><span class="p">,</span><span class="n">r</span><span class="m">1</span><span class="p">)}</span><span class="w">

</span><span class="c1"># raster stack of all rasters (each layer is a depth)</span><span class="w">
</span><span class="n">s</span><span class="m">1</span><span class="w">

</span><span class="c1">## class      : RasterStack </span><span class="w">
</span><span class="c1">## dimensions : 121, 121, 14641, 6  (nrow, ncol, ncell, nlayers)</span><span class="w">
</span><span class="c1">## resolution : 0.0008333333, 0.0008333333  (x, y)</span><span class="w">
</span><span class="c1">## extent     : 148.9996, 149.1004, -35.50042, -35.39958  (xmin, xmax, ymin, ymax)</span><span class="w">
</span><span class="c1">## crs        : +init=epsg:4283 +proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs </span><span class="w">
</span><span class="c1">## names      : NAT_CLY_VAL_000_005, NAT_CLY_VAL_005_015, NAT_CLY_VAL_015_030, NAT_CLY_VAL_030_060, NAT_CLY_VAL_060_100, NAT_CLY_VAL_100_200 </span><span class="w">
</span><span class="c1">## min values :            7.735192,            8.906991,           12.726418,           18.109673,           21.137390,           22.203936 </span><span class="w">
</span><span class="c1">## max values :            32.54842,            33.97256,            38.32691,            44.41605,            45.26889,            44.36512</span><span class="w">

</span><span class="c1"># plot</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
    <img src="/images/20200204gridsplines/unnamed-chunk-3-1.png" alt="SLGA1" />
    <figcaption>Figure 1. Digital soil maps of clay content for King Island. Depth support corresponds to GlobalSoilMap standard depths.</figcaption>
</figure>

<p>The workhorse function in the code above is the <code class="highlighter-rouge">get_soils_data</code>. Here we are downloading from the national data repository space (as opposed to getting state-based estimates which may or may not be of improved prediction certainty) for each of the GSM standard depths. We are just downloading the values, but keep in mind that one can also get the associated prediction uncertainties too. Check out the help file for this function for other goodies one can do with it. Basically we are downloading each layer of data within the defined area of interest which in this case is King Island.</p>

<p>Using the <code class="highlighter-rouge">ea_rasSp</code> function is relatively straightforward. Basically it will only ingests a raster stack. The function automatically assumes each raster layer represents a 3D soil representation, which could be GSM standard depths or some other representation. We specify this with the <code class="highlighter-rouge">dIn</code> parameter where <code class="highlighter-rouge">dIn = c(0,5,15,30,60,100,200)</code> corresponds to the GSM depths i.e. 0-5cm, 5-15cm, 15-30cm, 30-60cm, 60-100cm and 100-200cm. <code class="highlighter-rouge">dOut</code> is the parameter for the new depth intervals we want. Below we a signalling (just to be unusual) to get the 0-11cm, 11-25cm, 25-31cm, 21-50cm, and 50-180cm depth intervals. The <code class="highlighter-rouge">vlow</code> and <code class="highlighter-rouge">vhigh</code> parameters are for constraining the spline fit to be within normal ranges which for soil texture is between 0% and 100%. The other important parameter is <code class="highlighter-rouge">lam</code> which determines the amount of flex in the fitted spline. The value 0.1 is usually a acceptable choice, but one can select their own choice based on there own criteria. High values result in stiff splines while low values result in flexible splines.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># use raster spline function </span><span class="w">
</span><span class="n">s</span><span class="m">1</span><span class="n">.new</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ea_rasSp</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="c1"># raster stack object</span><span class="w">
             </span><span class="n">lam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="c1"># lambda</span><span class="w">
             </span><span class="n">dIn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">60</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">200</span><span class="p">),</span><span class="w"> </span><span class="c1"># These are SLGA standard depths (but could be any depths though)</span><span class="w">
             </span><span class="n">dOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">11</span><span class="p">,</span><span class="m">25</span><span class="p">,</span><span class="m">31</span><span class="p">,</span><span class="m">50</span><span class="p">,</span><span class="m">180</span><span class="p">),</span><span class="w">   </span><span class="c1"># User specified depths</span><span class="w">
             </span><span class="n">vlow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> 
             </span><span class="n">vhigh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w">
             </span><span class="n">show.progress</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="n">s</span><span class="m">1</span><span class="n">.new</span><span class="w">

</span><span class="c1">## class      : RasterStack </span><span class="w">
</span><span class="c1">## dimensions : 121, 121, 14641, 5  (nrow, ncol, ncell, nlayers)</span><span class="w">
</span><span class="c1">## resolution : 0.0008333333, 0.0008333333  (x, y)</span><span class="w">
</span><span class="c1">## extent     : 148.9996, 149.1004, -35.50042, -35.39958  (xmin, xmax, ymin, ymax)</span><span class="w">
</span><span class="c1">## crs        : NA </span><span class="w">
</span><span class="c1">## names      :   X0.11cm,  X11.25cm,  X25.31cm,  X31.50cm, X50.180cm </span><span class="w">
</span><span class="c1">## min values :  8.282192, 11.591473, 14.621008, 17.420295, 21.637719 </span><span class="w">
</span><span class="c1">## max values :  33.22039,  36.88600,  40.41217,  43.74120,  44.77895</span><span class="w">

</span><span class="c1"># make a plot</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="m">1</span><span class="n">.new</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
    <img src="/images/20200204gridsplines/unnamed-chunk-4-1.png" alt="SLGA2" />
    <figcaption>Figure 1. Digital soil maps of clay content for King Island. Depth support corresponds to the depths as requested; 0-11cm, 11-25cm,
25-31cm, 21-50cm, and 50-180cm depth intervals.</figcaption>
</figure>

<p>Probably a more usual thing to do might be to get to top 10cm, then 10-30cm, and finally 30-100cm.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># use raster spline function </span><span class="w">
</span><span class="n">s</span><span class="m">1</span><span class="n">.newer</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ea_rasSp</span><span class="p">(</span><span class="n">obj</span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="c1"># raster stack object</span><span class="w">
             </span><span class="n">lam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="c1"># lambda</span><span class="w">
             </span><span class="n">dIn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">60</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">200</span><span class="p">),</span><span class="w"> </span><span class="c1"># These are SLGA standard depths (but could be any depths though)</span><span class="w">
             </span><span class="n">dOut</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">10</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">100</span><span class="p">),</span><span class="w">   </span><span class="c1"># User specified depths</span><span class="w">
             </span><span class="n">vlow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> 
             </span><span class="n">vhigh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w">
             </span><span class="n">show.progress</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">

</span><span class="n">s</span><span class="m">1</span><span class="n">.newer</span><span class="w">

</span><span class="c1">## class      : RasterStack </span><span class="w">
</span><span class="c1">## dimensions : 121, 121, 14641, 3  (nrow, ncol, ncell, nlayers)</span><span class="w">
</span><span class="c1">## resolution : 0.0008333333, 0.0008333333  (x, y)</span><span class="w">
</span><span class="c1">## extent     : 148.9996, 149.1004, -35.50042, -35.39958  (xmin, xmax, ymin, ymax)</span><span class="w">
</span><span class="c1">## crs        : NA </span><span class="w">
</span><span class="c1">## names      :   X0.10cm,  X10.30cm, X30.100cm </span><span class="w">
</span><span class="c1">## min values :  8.190432, 12.196100, 19.818838 </span><span class="w">
</span><span class="c1">## max values :  33.11356,  37.59536,  44.84079</span><span class="w">

</span><span class="c1"># make a plot</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">s</span><span class="m">1</span><span class="n">.newer</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
    <img src="/images/20200204gridsplines/unnamed-chunk-5-1.png" alt="SLGA3" />
    <figcaption>Figure 1. Digital soil maps of clay content for King Island. Depth support corresponds to the depths as requested; 0-10cm, 10-30cm, cm, and 30-100cm depth intervals.</figcaption>
</figure>

<h3 id="a-final-word">A final word</h3>

<p>There is not too much more to this piece of work. The intention here was to illustrate that the outputs commonly generated in digital soil mapping that adhere the GSM specifications have much greater utility than just the standard depth intervals. The <code class="highlighter-rouge">ea_rasSp</code> is very much a beta version at this stage and could do with vectorisation and optimisation of compute. For now the workflow is a pixel-to-pixel routine. The actual spline fitting is super fast even without optimisation, but the sequential nature of pixel-to-pixel quickly ramps up the compute time for highly populated grids. Currently it would be useful for farm to regional extent soil mapping work as it is, but could indeed be parallelised for much larger extents without too much tinkering.</p>

<p>The spline is a very useful tool for utilising such maps and enabling one to develop their own customised maps with relatively little effort. An example application of this would be the creation of digital soil maps where the new depth intervals correspond to measurement depths of a network of soil moisture sensors across a field or farm. Or estimating carbon stocks to 1m (a simple average may suffice in this case), or to some customised depths etc. I could be argued that the spline model be used on the soil profile data to generate information to custom depths, and them model. And this maybe the suggested route, but here we are working under the assumption that we don’t have this point data and only have the raster data, of course which is publicly available. In any case, the take home message is just don’t settle for what digital soil information is available to you. Instead, derive the information to suit your needs and your specifications!</p>

<h2 id="references">References</h2>

<p>Arrouays, Dominique, Alex Mcbratney, Budiman Minasny, Jonathan Hempel, Gerard Heuvelink, R.A. Macmillan, Alfred Hartemink, P. Lagacherie, and Neil McKenzie. 2014. “The Globalsoilmap Project Specifications.” <em>GlobalSoilMap: Basis of the Global Spatial Soil Information System - Proceedings of the 1st GlobalSoilMap Conference</em>, January, 9–12. <a href="https://doi.org/10.1201/b16500-4">https://doi.org/10.1201/b16500-4</a>.</p>

<p>Bishop, T.F.A., A.B. McBratney, and G.M. Laslett. 1999. “Modelling Soil Attribute Depth Functions with Equal-Area Quadratic Smoothing Splines.” <em>Geoderma</em> 91 (1): 27–45. <a href="https://doi.org/https://doi.org/10.1016/S0016-7061(99)00003-8">https://doi.org/https://doi.org/10.1016/S0016-7061(99)00003-8</a>.</p>

<p>Grundy, M. J., R. A. Viscarra Rossel, R. D. Searle, P. L. Wilson, C. Chen, and L. J. Gregory. 2015. “Soil and Landscape Grid of Australia.” <em>Soil Res.</em> 53 (8): 835–44. <a href="https://doi.org/10.1071/SR15191">https://doi.org/10.1071/SR15191</a>.</p>

<p>Hengl, Jorge AND Heuvelink, Tomislav AND Mendes de Jesus. 2017. “SoilGrids250m: Global Gridded Soil Information Based on Machine Learning.” <em>PLOS ONE</em> 12 (2). Public Library of Science: 1–40. <a href="https://doi.org/10.1371/journal.pone.0169748">https://doi.org/10.1371/journal.pone.0169748</a>.</p>

<p>Malone, B.P., A.B. McBratney, B. Minasny, and G.M. Laslett. 2009. “Mapping Continuous Depth Functions of Soil Carbon Storage and Available Water Capacity.” <em>Geoderma</em> 154 (1): 138–52. <a href="https://doi.org/https://doi.org/10.1016/j.geoderma.2009.10.007">https://doi.org/https://doi.org/10.1016/j.geoderma.2009.10.007</a>.</p>

<p>Orton, T.G., M.J. Pringle, and T.F.A. Bishop. 2016. “A One-Step Approach for Modelling and Mapping Soil Properties Based on Profile Data Sampled over Varying Depth Intervals.” <em>Geoderma</em> 262: 174–86. <a href="https://doi.org/https://doi.org/10.1016/j.geoderma.2015.08.013">https://doi.org/https://doi.org/10.1016/j.geoderma.2015.08.013</a>.</p>

<p>Poggio, Laura, and Alessandro Gimona. 2014. “National Scale 3D Modelling of Soil Organic Carbon Stocks with Uncertainty Propagation — an Example from Scotland.” <em>Geoderma</em> 232-234: 284–99. <a href="https://doi.org/https://doi.org/10.1016/j.geoderma.2014.05.004">https://doi.org/https://doi.org/10.1016/j.geoderma.2014.05.004</a>.</p>

<p>Sanchez, Pedro A., Sonya Ahamed, Florence Carré, Alfred E. Hartemink, Jonathan Hempel, Jeroen Huising, Philippe Lagacherie, et al. 2009. “Digital Soil Map of the World.” <em>Science</em> 325 (5941). American Association for the Advancement of Science: 680–81. <a href="https://doi.org/10.1126/science.1175084">https://doi.org/10.1126/science.1175084</a>.</p>

<p>Viscarra Rossel, R. A., C. Chen, M. J. Grundy, R. Searle, D. Clifford, and P. H. Campbell. 2015. “The Australian Three-Dimensional Soil Grid: Australia’s Contribution to the &lt;i&gt;GlobalSoilMap&lt;/I&gt; Project.” <em>Soil Res.</em> 53 (8): 845–64. <a href="https://doi.org/10.1071/SR14366">https://doi.org/10.1071/SR14366</a>.</p>

      <footer class="entry-meta">
        <span>Updated on <span class="entry-date date published updated"><time datetime="2020-04-27">April 27, 2020</time></span></span>
        <span class="author vcard"><span class="fn">Smart Digital Agriculture</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/UseCases/Writings/gridsplines/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/UseCases/Writings/gridsplines/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/UseCases/Writings/gridsplines/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
    <!--<span>&copy; 2023 Smart Digital Agriculture. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>-->

<footer role="contentinfo">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="mailto:malone.brendan1001@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/brendo1001">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://twitter.com/soilmalone">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Smart Digital Agriculture 2023, All Rights Reserved.</p>
            </div>
        </div>
    </div>
</footer>

</div><!-- /.footer-wrapper -->

<!-- JQuery JavaScript -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>

<!-- Bootstrap Core JavaScript -->
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<!-- Clean Blog JavaScript -->
<script src="/assets/js/clean-blog.min.js"></script>

<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87285093-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


<!-- Math equation support by MathJax -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: {
            equationNumbers: { autoNumber: "all" },
            inlineMath: [['$','$'],['\\(','\\)']],
        },
        "HTML-CSS": {
            availableFonts: ["TeX"],
            preferredFont: "TeX",
        },
    });
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>




</body>
</html>
