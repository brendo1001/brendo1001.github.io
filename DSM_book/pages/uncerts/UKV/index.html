<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Quantification of prediction uncertainties &#8211; Smart Digital Agriculture</title>
<meta name="description" content="Universal kriging prediction variance">


<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="Quantification of prediction uncertainties">
<meta name="twitter:description" content="Universal kriging prediction variance">
<meta name="twitter:creator" content="@soilmalone">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Quantification of prediction uncertainties">
<meta property="og:description" content="Universal kriging prediction variance">
<meta property="og:url" content="/DSM_book/pages/uncerts/UKV/">
<meta property="og:site_name" content="Smart Digital Agriculture">

<meta name="google-site-verification" content="googledd99b1430269a639.html">



<link rel="canonical" href="/DSM_book/pages/uncerts/UKV/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Smart Digital Agriculture Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="/assets/css/bootstrap.min.css">
<!-- Clean Blog CSS -->
<link rel="stylesheet" href="/assets/css/clean-blog.css">
<!-- HPSTR main CSS -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Custom Fonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Viga|Ubuntu:700' rel='stylesheet' type='text/css'>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

</head>

<body id="page" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Smart Digital Agriculture</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    
                    <li><a href="/" >Home</a></li>
                
                    
                    <li><a href="/publications/" >Publications</a></li>
                
                    
                    <li><a href="/software/" >Software</a></li>
                
                    
                    <li><a href="/blog/" >Journal Digests</a></li>
                
                    
                    <li><a href="/UseCases/" >Blog</a></li>
                
                    
                    <li><a href="/DSM_book/" >Using R for Digital Soil Mapping</a></li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Page Header -->
<header class="intro-header" style="background-image: url('/images/pedometric2017.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
                    <h1>Quantification of prediction uncertainties</h1>
                    
                        <hr class="small">
                        <span class="subheading">Universal kriging prediction variance</span>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<!--

-->

<div id="main" role="main">
  <article class="hentry">
    <!--
    <header class="header-title">
      <div class="header-title-wrap">
        <h1 class="entry-title">Quantification of prediction uncertainties</h1>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~20 minutes
        </p>
        
      </div>
    </header>
    -->
    <div class="entry-content">
      <h2 id="introduction">Introduction</h2>

<ul>
  <li><a href="#s-1">Defining the model parameters</a></li>
  <li><a href="#s-2">Spatial Mapping</a></li>
  <li><a href="#s-3">Validating the quantification of uncertainties</a></li>
</ul>

<p>In the page regarding digital soil mapping of continuous variables,
<a href="/DSM_book/pages/dsm_cont/sspfs/RK/UK/">universal kriging was explored</a>. This model is ideal from the perspective that both the correlated
variables and model residuals are handled simultaneously. This model
also automatically generates prediction uncertainty via the kriging
variance. It is with this variance estimate that we can define a
prediction interval. Here, a 90% prediction interval will be defined for
the mapping purposes. Although for validation, a number of levels of
confidence will be defined and subsequently validated in order to assess
the performance and sensitivity of the uncertainty estimates.</p>

<h3 id="defining-the-model-parameters-">Defining the model parameters <a id="s-1"></a></h3>

<p>First we need to load in all the libraries that are necessary for this
section and load in the necessary data.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ithir</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">rgdal</span><span class="p">)</span><span class="w">

</span><span class="c1">## rgdal: version: 1.4-4, (SVN revision 833)</span><span class="w">
</span><span class="c1">##  Geospatial Data Abstraction Library extensions to R successfully loaded</span><span class="w">
</span><span class="c1">##  Loaded GDAL runtime: GDAL 2.2.3, released 2017/11/20</span><span class="w">
</span><span class="c1">##  Path to GDAL shared files: /usr/share/gdal/2.2</span><span class="w">
</span><span class="c1">##  GDAL binary built with GEOS: TRUE </span><span class="w">
</span><span class="c1">##  Loaded PROJ.4 runtime: Rel. 4.9.3, 15 August 2016, [PJ_VERSION: 493]</span><span class="w">
</span><span class="c1">##  Path to PROJ.4 shared files: (autodetected)</span><span class="w">
</span><span class="c1">##  Linking to sp version: 1.3-1</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">gstat</span><span class="p">)</span><span class="w">

</span><span class="c1">## Registered S3 method overwritten by 'xts':</span><span class="w">
</span><span class="c1">##   method     from</span><span class="w">
</span><span class="c1">##   as.zoo.xts zoo</span><span class="w">

</span><span class="c1"># Point data</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">HV_subsoilpH</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">HV_subsoilpH</span><span class="p">)</span><span class="w">

</span><span class="c1">## 'data.frame':    506 obs. of  14 variables:</span><span class="w">
</span><span class="c1">##  $ X                       : num  340386 340345 340559 340483 340734 ...</span><span class="w">
</span><span class="c1">##  $ Y                       : num  6368690 6368491 6369168 6368740 6368964 ...</span><span class="w">
</span><span class="c1">##  $ pH60_100cm              : num  4.47 5.42 6.26 8.03 8.86 ...</span><span class="w">
</span><span class="c1">##  $ Terrain_Ruggedness_Index: num  1.34 1.42 1.64 1.04 1.27 ...</span><span class="w">
</span><span class="c1">##  $ AACN                    : num  1.619 0.281 2.301 1.74 3.114 ...</span><span class="w">
</span><span class="c1">##  $ Landsat_Band1           : int  57 47 59 52 62 53 47 52 53 63 ...</span><span class="w">
</span><span class="c1">##  $ Elevation               : num  103.1 103.7 99.9 101.9 99.8 ...</span><span class="w">
</span><span class="c1">##  $ Hillshading             : num  1.849 1.428 0.934 1.517 1.652 ...</span><span class="w">
</span><span class="c1">##  $ Light_insolation        : num  1689 1701 1722 1688 1735 ...</span><span class="w">
</span><span class="c1">##  $ Mid_Slope_Positon       : num  0.876 0.914 0.844 0.848 0.833 ...</span><span class="w">
</span><span class="c1">##  $ MRVBF                   : num  3.85 3.31 3.66 3.92 3.89 ...</span><span class="w">
</span><span class="c1">##  $ NDVI                    : num  -0.143 -0.386 -0.197 -0.14 -0.15 ...</span><span class="w">
</span><span class="c1">##  $ TWI                     : num  17.5 18.2 18.8 18 17.8 ...</span><span class="w">
</span><span class="c1">##  $ Slope                   : num  1.79 1.42 1.01 1.49 1.83 ...</span><span class="w">

</span><span class="c1"># Raster data</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">hunterCovariates_sub</span><span class="p">)</span><span class="w">
</span><span class="n">hunterCovariates_sub</span><span class="w">

</span><span class="c1">## class      : RasterStack </span><span class="w">
</span><span class="c1">## dimensions : 249, 210, 52290, 11  (nrow, ncol, ncell, nlayers)</span><span class="w">
</span><span class="c1">## resolution : 25, 25  (x, y)</span><span class="w">
</span><span class="c1">## extent     : 338422.3, 343672.3, 6364203, 6370428  (xmin, xmax, ymin, ymax)</span><span class="w">
</span><span class="c1">## crs        : +proj=utm +zone=56 +south +ellps=WGS84 +datum=WGS84 +units=m +no_defs </span><span class="w">
</span><span class="c1">## names      : Terrain_Ruggedness_Index,        AACN, Landsat_Band1,   Elevation, Hillshading, Light_insolation, Mid_Slope_Positon,       MRVBF,        NDVI,         TWI,       Slope </span><span class="w">
</span><span class="c1">## min values :                 0.194371,    0.000000,     26.000000,   72.217499,    0.000677,      1236.662840,          0.000009,    0.000002,   -0.573034,    8.224325,    0.001708 </span><span class="w">
</span><span class="c1">## max values :                15.945321,  106.665482,    140.000000,  212.632507,   32.440960,      1934.199950,          0.956529,    4.581594,    0.466667,   20.393652,   21.809752</span><span class="w">
</span></code></pre></div></div>

<p>You will notice for <code class="highlighter-rouge">HV_subsoilpH</code> that these data have already been
intersected with a number of covariates. The <code class="highlighter-rouge">hunterCovariates_sub</code> are
a <code class="highlighter-rouge">rasterStack</code> of the same covariates (although the spatial extent is
smaller).</p>

<p>Now to prepare the data for the universal kriging model. Below we
partition the dataset via a randomized sub-setting whereby 70% of the
data is used for model fitting work, leaving the other 30% for
independent validation of the model plus the quantification of
uncertainties.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># subset data for modeling</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">HV_subsoilpH</span><span class="p">),</span><span class="w"> </span><span class="m">0.7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">HV_subsoilpH</span><span class="p">))</span><span class="w">
</span><span class="n">cDat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">HV_subsoilpH</span><span class="p">[</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">vDat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">HV_subsoilpH</span><span class="p">[</span><span class="o">-</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="n">nrow</span><span class="p">(</span><span class="n">cDat</span><span class="p">)</span><span class="w">

</span><span class="c1">## [1] 354</span><span class="w">

</span><span class="n">nrow</span><span class="p">(</span><span class="n">vDat</span><span class="p">)</span><span class="w">

</span><span class="c1">## [1] 152</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">cDat</code> and <code class="highlighter-rouge">vDat</code> objects correspond to the model calibration and
validation data sets respectively.</p>

<p>Now to prepare the data for the model. here we are specifying the
spatial coordinate structure of the data.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># coordinates</span><span class="w">
</span><span class="n">coordinates</span><span class="p">(</span><span class="n">cDat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">~</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Y</span><span class="w">

</span><span class="c1"># remove CRS from grids</span><span class="w">
</span><span class="n">crs</span><span class="p">(</span><span class="n">hunterCovariates_sub</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span></code></pre></div></div>

<p>We will firstly use a step wise regression to determine a parsimonious
model are the most important covariates.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Full model</span><span class="w">
</span><span class="n">lm1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">pH60_100cm</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Terrain_Ruggedness_Index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">AACN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Landsat_Band1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Elevation</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">Hillshading</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Light_insolation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Mid_Slope_Positon</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MRVBF</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NDVI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TWI</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">Slope</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cDat</span><span class="p">)</span><span class="w">

</span><span class="c1"># Parsimous model</span><span class="w">
</span><span class="n">lm2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">step</span><span class="p">(</span><span class="n">lm1</span><span class="p">,</span><span class="w"> </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"both"</span><span class="p">,</span><span class="w"> </span><span class="n">trace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">as.formula</span><span class="p">(</span><span class="n">lm2</span><span class="p">)</span><span class="w">

</span><span class="c1">## pH60_100cm ~ AACN + Landsat_Band1 + Elevation + Hillshading + </span><span class="w">
</span><span class="c1">##     Mid_Slope_Positon + MRVBF + NDVI + TWI</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">lm2</span><span class="p">)</span><span class="w">

</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Call:</span><span class="w">
</span><span class="c1">## lm(formula = pH60_100cm ~ AACN + Landsat_Band1 + Elevation + </span><span class="w">
</span><span class="c1">##     Hillshading + Mid_Slope_Positon + MRVBF + NDVI + TWI, data = cDat)</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Residuals:</span><span class="w">
</span><span class="c1">##     Min      1Q  Median      3Q     Max </span><span class="w">
</span><span class="c1">## -3.0255 -0.7677 -0.1066  0.7161  3.4354 </span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Coefficients:</span><span class="w">
</span><span class="c1">##                    Estimate Std. Error t value Pr(&gt;|t|)    </span><span class="w">
</span><span class="c1">## (Intercept)        7.699430   1.065126   7.229 3.16e-12 ***</span><span class="w">
</span><span class="c1">## AACN               0.041764   0.008303   5.030 7.89e-07 ***</span><span class="w">
</span><span class="c1">## Landsat_Band1     -0.038015   0.010637  -3.574 0.000402 ***</span><span class="w">
</span><span class="c1">## Elevation         -0.017069   0.006305  -2.707 0.007119 ** </span><span class="w">
</span><span class="c1">## Hillshading        0.100432   0.021836   4.599 5.96e-06 ***</span><span class="w">
</span><span class="c1">## Mid_Slope_Positon  0.997455   0.314699   3.170 0.001663 ** </span><span class="w">
</span><span class="c1">## MRVBF              0.258095   0.101318   2.547 0.011287 *  </span><span class="w">
</span><span class="c1">## NDVI               4.964339   1.028226   4.828 2.08e-06 ***</span><span class="w">
</span><span class="c1">## TWI                0.113413   0.053713   2.111 0.035453 *  </span><span class="w">
</span><span class="c1">## ---</span><span class="w">
</span><span class="c1">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Residual standard error: 1.169 on 345 degrees of freedom</span><span class="w">
</span><span class="c1">## Multiple R-squared:  0.2403, Adjusted R-squared:  0.2227 </span><span class="w">
</span><span class="c1">## F-statistic: 13.64 on 8 and 345 DF,  p-value: &lt; 2.2e-16</span><span class="w">
</span></code></pre></div></div>

<p>Now we can construct the universal kriging model using the step wise
selected covariates.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vgm1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">variogram</span><span class="p">(</span><span class="n">pH60_100cm</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">AACN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Landsat_Band1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Hillshading</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Mid_Slope_Positon</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">MRVBF</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NDVI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TWI</span><span class="p">,</span><span class="w"> </span><span class="n">cDat</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">200</span><span class="p">)</span><span class="w">
</span><span class="n">mod</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vgm</span><span class="p">(</span><span class="n">psill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">var</span><span class="p">(</span><span class="n">cDat</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="p">),</span><span class="w"> </span><span class="s2">"Sph"</span><span class="p">,</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10000</span><span class="p">,</span><span class="w"> </span><span class="n">nugget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">model_1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">fit.variogram</span><span class="p">(</span><span class="n">vgm1</span><span class="p">,</span><span class="w"> </span><span class="n">mod</span><span class="p">)</span><span class="w">

</span><span class="n">gUK</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gstat</span><span class="p">(</span><span class="kc">NULL</span><span class="p">,</span><span class="w"> </span><span class="s2">"hunterpH_UK"</span><span class="p">,</span><span class="w"> </span><span class="n">pH60_100cm</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">AACN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Landsat_Band1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Hillshading</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">Mid_Slope_Positon</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MRVBF</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NDVI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TWI</span><span class="p">,</span><span class="w"> </span><span class="n">cDat</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_1</span><span class="p">)</span><span class="w">
</span><span class="n">gUK</span><span class="w">

</span><span class="c1">## data:</span><span class="w">
</span><span class="c1">## hunterpH_UK : formula = pH60_100cm`~`AACN + Landsat_Band1 + Hillshading + Mid_Slope_Positon + MRVBF + NDVI + TWI ; data dim = 354 x 12</span><span class="w">
</span><span class="c1">## variograms:</span><span class="w">
</span><span class="c1">##                model     psill    range</span><span class="w">
</span><span class="c1">## hunterpH_UK[1]   Nug 0.7118707   0.0000</span><span class="w">
</span><span class="c1">## hunterpH_UK[2]   Sph 0.6574215 652.7561</span><span class="w">
</span></code></pre></div></div>

<p><a href="#top">Back to top</a></p>

<h3 id="spatial-mapping-">Spatial mapping <a id="s-2"></a></h3>

<p>Here we want to produce four maps that will correspond to:</p>

<ol>
  <li>The lower end of the 90% prediction interval or 5<sup><em>t**h</em></sup>
percentile of the empirical probability density function.</li>
  <li>The universal kriging prediction.</li>
  <li>The upper end of the 90% prediction interval or 95<sup><em>t**h</em></sup>
percentile of the empirical probability density function.</li>
  <li>The prediction interval range.</li>
</ol>

<p>For the prediction we use the raster <code class="highlighter-rouge">interpolate</code> function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">UK.P.map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interpolate</span><span class="p">(</span><span class="n">hunterCovariates_sub</span><span class="p">,</span><span class="w"> </span><span class="n">gUK</span><span class="p">,</span><span class="w"> </span><span class="n">xyOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> 
    </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"UK_predMap.tif"</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GTiff"</span><span class="p">,</span><span class="w"> </span><span class="n">overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Setting the <code class="highlighter-rouge">index</code> value to 2 lets us map the kriging variance which is
needed for the prediction interval. Taking the square root of this
estimates the standard deviation which we can then multiply by the
quantile function value that corresponds either the lower
(5<sup><em>t**h</em></sup>) or upper tail ((95<sup><em>t**h</em></sup>)) probability
which is 1.644854. We then both add and subtract this value from the
universal kriging prediction to derive the 90% prediction limits.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># prediction variance</span><span class="w">
</span><span class="n">UK.var.map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">interpolate</span><span class="p">(</span><span class="n">hunterCovariates_sub</span><span class="p">,</span><span class="w"> </span><span class="n">gUK</span><span class="p">,</span><span class="w"> </span><span class="n">xyOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="o">=</span><span class="s2">"UK_predVarMap.tif"</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"GTiff"</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1">#standard deviation</span><span class="w">
</span><span class="n">f</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> 
</span><span class="n">UK.stdev.map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="n">UK.var.map</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="o">=</span><span class="n">f</span><span class="m">2</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">"UK_predSDMap.tif"</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"GTiff"</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1">#Z level</span><span class="w">
</span><span class="n">zlev</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="m">0.95</span><span class="p">)</span><span class="w">
</span><span class="n">f</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">zlev</span><span class="p">)</span><span class="w"> 
</span><span class="n">UK.mult.map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="n">UK.stdev.map</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="o">=</span><span class="n">f</span><span class="m">2</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">"UK_multMap.tif"</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"GTiff"</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1">#Add and subtract mult from prediction</span><span class="w">
</span><span class="n">m</span><span class="m">1</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stack</span><span class="p">(</span><span class="n">UK.P.map</span><span class="p">,</span><span class="n">UK.mult.map</span><span class="p">)</span><span class="w">

</span><span class="c1">#upper PL</span><span class="w">
</span><span class="n">f</span><span class="m">3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="w"> 
</span><span class="n">UK.upper.map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="n">m</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="o">=</span><span class="n">f</span><span class="m">3</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">"UK_upperMap.tif"</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"GTiff"</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">

</span><span class="c1">#lower PL</span><span class="w">
</span><span class="n">f</span><span class="m">4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="w"> 
</span><span class="n">UK.lower.map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="n">m</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="o">=</span><span class="n">f</span><span class="m">4</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">"UK_lowerMap.tif"</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"GTiff"</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span><span class="o">@</span><span class="w">

</span><span class="err">\</span><span class="n">indent</span><span class="w"> </span><span class="n">Finally</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">derive</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="m">90</span><span class="err">\</span><span class="o">%</span><span class="w"> </span><span class="n">prediction</span><span class="w"> </span><span class="n">limit</span><span class="w"> </span><span class="n">range</span><span class="w">

</span><span class="o">&lt;&lt;</span><span class="n">echo</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">tidy</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span><span class="n">cache</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">eval</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">warning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">background</span><span class="o">=</span><span class="s1">'white'</span><span class="o">&gt;&gt;=</span><span class="w">
</span><span class="c1"># prediction range</span><span class="w">
</span><span class="n">m</span><span class="m">2</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stack</span><span class="p">(</span><span class="n">UK.upper.map</span><span class="p">,</span><span class="n">UK.lower.map</span><span class="p">)</span><span class="w">

</span><span class="n">f</span><span class="m">5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="w"> 
</span><span class="n">UK.piRange.map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="n">m</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="o">=</span><span class="n">f</span><span class="m">5</span><span class="p">,</span><span class="n">filename</span><span class="o">=</span><span class="s2">"UK_piRangeMap.tif"</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s2">"GTiff"</span><span class="p">,</span><span class="n">progress</span><span class="o">=</span><span class="s2">"text"</span><span class="p">,</span><span class="n">overwrite</span><span class="o">=</span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Finally to derive the 90% prediction limit range.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># prediction range</span><span class="w">
</span><span class="n">m</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">stack</span><span class="p">(</span><span class="n">UK.upper.map</span><span class="p">,</span><span class="w"> </span><span class="n">UK.lower.map</span><span class="p">)</span><span class="w">

</span><span class="n">f</span><span class="m">5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">x</span><span class="p">[</span><span class="m">2</span><span class="p">])</span><span class="w">
</span><span class="n">UK.piRange.map</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">calc</span><span class="p">(</span><span class="n">m</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">fun</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"UK_piRangeMap.tif"</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GTiff"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">progress</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>So to plot them all together we use the following script. Here we
explicitly create a color ramp that follows reasonably closely the pH
color ramp. Then we scale each map to the common range for better
comparison.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># color ramp</span><span class="w">
</span><span class="n">phCramp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#d53e4f"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#f46d43"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fdae61"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fee08b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#ffffbf"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#e6f598"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"#abdda4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#3288bd"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#5e4fa2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#542788"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#2d004b"</span><span class="p">)</span><span class="w">
</span><span class="n">brk</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">14</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">UK.lower.map</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"90% Lower prediction limit"</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brk</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phCramp</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">UK.P.map</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Prediction"</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brk</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phCramp</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">UK.upper.map</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"90% Upper prediction limit"</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brk</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phCramp</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">UK.piRange.map</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Prediction limit range"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">terrain.colors</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> 
    </span><span class="m">6.5</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6.5</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<figure>
    <img src="/images/dsm_book/uncert_UKmaps.png" alt="rconsole" />
    <figcaption> Soil pH predictions and prediction limits derived using a universal kriging model.</figcaption>
</figure>

<p><a href="#top">Back to top</a></p>

<h3 id="validating-the-quantification-of-uncertainty-">Validating the quantification of uncertainty <a id="s-3"></a></h3>

<p>One of the ways to assess the performance of the uncertainty
quantification is to evaluate the occurrence of times where an observed
value is encapsulated by an associated prediction interval. Given a
stated level of confidence, we should also expect to find the same
percentage of observations encapsulated by its associated prediction
interval. We define this percentage as the prediction interval coverage
probability (PICP). The PICP was used in both Solomatine and Shrestha
(2009) and Malone, McBratney, and Minasny (2011). To assess the
sensitivity of the uncertainty quantification, we define prediction
intervals at a number of levels of confidence and then assess the PICP.
Ideally, a 1:1 relationship would ensue.</p>

<p>First we apply the universal kriging model <code class="highlighter-rouge">gUK</code> to the validation data
in order to estimate pH and the prediction variance.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">coordinates</span><span class="p">(</span><span class="n">vDat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">~</span><span class="n">X</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Y</span><span class="w">

</span><span class="c1"># Prediction</span><span class="w">
</span><span class="n">UK.preds.V</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">krige</span><span class="p">(</span><span class="n">pH60_100cm</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">AACN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Landsat_Band1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Hillshading</span><span class="w"> </span><span class="o">+</span><span class="w"> 
    </span><span class="n">Mid_Slope_Positon</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">MRVBF</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">NDVI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TWI</span><span class="p">,</span><span class="w"> </span><span class="n">cDat</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">model_1</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vDat</span><span class="p">))</span><span class="w">

</span><span class="c1">## [using universal kriging]</span><span class="w">

</span><span class="n">UK.preds.V</span><span class="o">$</span><span class="n">stdev</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">sqrt</span><span class="p">(</span><span class="n">UK.preds.V</span><span class="o">$</span><span class="n">var1.var</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">UK.preds.V</span><span class="p">)</span><span class="w">

</span><span class="c1">## 'data.frame':    152 obs. of  5 variables:</span><span class="w">
</span><span class="c1">##  $ X        : num  340386 340559 340780 340861 340905 ...</span><span class="w">
</span><span class="c1">##  $ Y        : num  6368690 6369168 6369166 6368874 6368790 ...</span><span class="w">
</span><span class="c1">##  $ var1.pred: num  7.4 7.1 7.35 6.53 5.71 ...</span><span class="w">
</span><span class="c1">##  $ var1.var : num  1.04 1.21 1.2 1.17 1.19 ...</span><span class="w">
</span><span class="c1">##  $ stdev    : num  1.02 1.1 1.09 1.08 1.09 ...</span><span class="w">
</span></code></pre></div></div>

<p>Then we define a vector of quantile function values for a sequence of
probabilities using the <code class="highlighter-rouge">qnorm</code> function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">qp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">qnorm</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0.995</span><span class="p">,</span><span class="w"> </span><span class="m">0.9875</span><span class="p">,</span><span class="w"> </span><span class="m">0.975</span><span class="p">,</span><span class="w"> </span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0.525</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p>Then we estimate the prediction limits for each confidence level.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># zfactor multiplication</span><span class="w">
</span><span class="n">vMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">UK.preds.V</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">qp</span><span class="p">))</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">qp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">vMat</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">UK.preds.V</span><span class="o">$</span><span class="n">stdev</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">qp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># upper</span><span class="w">
</span><span class="n">uMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">UK.preds.V</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">qp</span><span class="p">))</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">qp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">uMat</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">UK.preds.V</span><span class="o">$</span><span class="n">var1.pred</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">vMat</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># lower</span><span class="w">
</span><span class="n">lMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">UK.preds.V</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">qp</span><span class="p">))</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="nf">length</span><span class="p">(</span><span class="n">qp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">lMat</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">UK.preds.V</span><span class="o">$</span><span class="n">var1.pred</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">vMat</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Then we want to evaluate the PICP for each confidence level.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">bMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">UK.preds.V</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">qp</span><span class="p">))</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="n">ncol</span><span class="p">(</span><span class="n">bMat</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">bMat</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">vDat</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">uMat</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">vDat</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> 
        </span><span class="n">lMat</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">])</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">colSums</span><span class="p">(</span><span class="n">bMat</span><span class="p">)</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">bMat</span><span class="p">)</span><span class="w">

</span><span class="c1">##  [1] 0.97368421 0.96052632 0.94078947 0.90789474 0.82236842 0.63815789</span><span class="w">
</span><span class="c1">##  [7] 0.45394737 0.22368421 0.10526316 0.05921053</span><span class="w">
</span></code></pre></div></div>

<p>Plotting the confidence level against the PICP provides a visual means
to assess the fidelity about the 1:1 line. As can be seen below, the
PICP follows closely the 1:1 line.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># make plot</span><span class="w">
</span><span class="n">cs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">99</span><span class="p">,</span><span class="w"> </span><span class="m">97.5</span><span class="p">,</span><span class="w"> </span><span class="m">95</span><span class="p">,</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="m">80</span><span class="p">,</span><span class="w"> </span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="n">colSums</span><span class="p">(</span><span class="n">bMat</span><span class="p">)</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">bMat</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>
<figure>
    <img src="/images/dsm_book/PICP_UK.png" alt="rconsole" />
    <figcaption> Plot of PICP and confidence level based on validation of universal kriging model.</figcaption>
</figure>

<p>So to summarize. We may evaluate the performance of the universal
kriging model on the basis of the predictions. Using the validation data
we would use the <code class="highlighter-rouge">goof</code> function for that purpose.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ithir</span><span class="o">::</span><span class="n">goof</span><span class="p">(</span><span class="n">observed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vDat</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="p">,</span><span class="w"> </span><span class="n">predicted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">UK.preds.V</span><span class="o">$</span><span class="n">var1.pred</span><span class="p">)</span><span class="w">

</span><span class="c1">##          R2 concordance      MSE     RMSE       bias</span><span class="w">
</span><span class="c1">## 1 0.4299833    0.571746 1.083256 1.040796 0.04779541</span><span class="w">
</span></code></pre></div></div>

<p>And then we may assess the uncertainties on the basis of the PICP like
shown below, together with assessing the quantiles of the distribution
of the prediction limit range for a given prediction confidence level
(here 90%).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">99</span><span class="p">,</span><span class="w"> </span><span class="m">97.5</span><span class="p">,</span><span class="w"> </span><span class="m">95</span><span class="p">,</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="m">80</span><span class="p">,</span><span class="w"> </span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">  </span><span class="c1"># confidence level</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">lMat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cs</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">uMat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cs</span><span class="w">
</span><span class="n">quantile</span><span class="p">(</span><span class="n">uMat</span><span class="p">[,</span><span class="w"> </span><span class="s2">"90"</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lMat</span><span class="p">[,</span><span class="w"> </span><span class="s2">"90"</span><span class="p">])</span><span class="w">

</span><span class="c1">##       0%      25%      50%      75%     100% </span><span class="w">
</span><span class="c1">## 2.983870 3.274481 3.400427 3.500311 3.889930</span><span class="w">
</span></code></pre></div></div>

<p>As can be noted above, the prediction interval range is relatively
homogeneous and this is corroborated on the associated map created
earlier.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="references">References</h3>

<p><a href="#top">Back to top</a></p>

<p>Malone, B P, A B McBratney, and B Minasny. 2011. Empirical Estimates of
Uncertainty for Mapping Continuous Depth Functions of Soil Attributes.
<em>Geoderma</em> 160: 61426.</p>

<p>Solomatine, D. P, and D. L Shrestha. 2009. A Novel Method to Estimate
Model Uncertainty Using Machine Learning Techniques. <em>Water Resources
Research</em> 45: Article Number: W00B11.</p>

      <footer class="entry-meta">
        <span>Updated on <span class="entry-date date published updated"><time datetime="2020-11-24">November 24, 2020</time></span></span>
        <span class="author vcard"><span class="fn">Smart Digital Agriculture</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/DSM_book/pages/uncerts/UKV/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/DSM_book/pages/uncerts/UKV/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/DSM_book/pages/uncerts/UKV/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
    <!--<span>&copy; 2023 Smart Digital Agriculture. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>-->

<footer role="contentinfo">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="mailto:malone.brendan1001@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/brendo1001">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://twitter.com/soilmalone">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Smart Digital Agriculture 2023, All Rights Reserved.</p>
            </div>
        </div>
    </div>
</footer>

</div><!-- /.footer-wrapper -->

<!-- JQuery JavaScript -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>

<!-- Bootstrap Core JavaScript -->
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<!-- Clean Blog JavaScript -->
<script src="/assets/js/clean-blog.min.js"></script>

<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87285093-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


<!-- Math equation support by MathJax -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: {
            equationNumbers: { autoNumber: "all" },
            inlineMath: [['$','$'],['\\(','\\)']],
        },
        "HTML-CSS": {
            availableFonts: ["TeX"],
            preferredFont: "TeX",
        },
    });
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>




</body>
</html>
