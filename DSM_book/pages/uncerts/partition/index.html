<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Quantification of prediction uncertainties &#8211; Smart Digital Agriculture</title>
<meta name="description" content="local errors and data partitioning">


<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="Quantification of prediction uncertainties">
<meta name="twitter:description" content="local errors and data partitioning">
<meta name="twitter:creator" content="@soilmalone">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Quantification of prediction uncertainties">
<meta property="og:description" content="local errors and data partitioning">
<meta property="og:url" content="/DSM_book/pages/uncerts/partition/">
<meta property="og:site_name" content="Smart Digital Agriculture">

<meta name="google-site-verification" content="googledd99b1430269a639.html">



<link rel="canonical" href="/DSM_book/pages/uncerts/partition/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Smart Digital Agriculture Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="/assets/css/bootstrap.min.css">
<!-- Clean Blog CSS -->
<link rel="stylesheet" href="/assets/css/clean-blog.css">
<!-- HPSTR main CSS -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Custom Fonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Viga|Ubuntu:700' rel='stylesheet' type='text/css'>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

</head>

<body id="page" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Smart Digital Agriculture</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    
                    <li><a href="/" >Home</a></li>
                
                    
                    <li><a href="/publications/" >Publications</a></li>
                
                    
                    <li><a href="/software/" >Software</a></li>
                
                    
                    <li><a href="/blog/" >Journal Digests</a></li>
                
                    
                    <li><a href="/UseCases/" >Blog</a></li>
                
                    
                    <li><a href="/DSM_book/" >Using R for Digital Soil Mapping</a></li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Page Header -->
<header class="intro-header" style="background-image: url('/images/pedometric2017.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
                    <h1>Quantification of prediction uncertainties</h1>
                    
                        <hr class="small">
                        <span class="subheading">local errors and data partitioning</span>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<!--

-->

<div id="main" role="main">
  <article class="hentry">
    <!--
    <header class="header-title">
      <div class="header-title-wrap">
        <h1 class="entry-title">Quantification of prediction uncertainties</h1>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~22 minutes
        </p>
        
      </div>
    </header>
    -->
    <div class="entry-content">
      <h4 id="code">CODE:</h4>
<p><a href="/DSM_book/rcode/P7_uncerts_partition.R">Get the code used for this section here</a></p>

<h3 id="uncertainty-estimation-based-on-local-errors-and-data-partitioning">Uncertainty estimation based on local errors and data partitioning</h3>

<ul>
  <li><a href="#s-1">Pre-work reading</a></li>
  <li><a href="#s-2">Defining the model parameters</a></li>
  <li><a href="#s-3">Within ruleset prediction limits</a></li>
  <li><a href="#s-4">Mapping predictions and model uncertainties</a></li>
  <li><a href="#s-5">Evaluating the quantification of uncertainties</a></li>
</ul>

<h3 id="pre-work-reading-">Pre-work reading <a id="s-1"></a></h3>

<p>The approach for uncertainty quantification described here and <a href="/DSM_book/pages/uncerts/fuzzy/">in further section</a> are empirical methods whereby the prediction intervals are defined from the distribution of underlying model errors i.e. the deviation between observation and model predictions.</p>

<p>In other types of uncertainty quantification, the prediction limits are not spatially uniform as they are for <a href="/DSM_book/pages/uncerts/boot/">bootstrap uncertainty quantification</a>. Rather they are a function of the landscape. For example, in some areas of the landscape, or in some particular landscape situations, the prediction is going to be more accurate than in other situations.</p>

<p>For the immediate approach, an explicit landscape partition is used to define likely areas where the quantification of uncertainty may differ. This approach uses the <a href="/DSM_book/pages/dsm_cont/sspfs/cubist/">Cubist data mining algorithm</a> for prediction and partitioning of the landscape. Within each partitioned area, we can then define the distribution of model errors.</p>

<p>This approach for uncertainty quantification was used by Malone et al. (2014) where soil pH was predicted using a Cubist model and residual kriging spatial model.</p>

<p>This approach and the <a href="/DSM_book/pages/uncerts/fuzzy/">fuzzy clustering approach</a> are useful from the viewpoint that complex models  in terms of parameterisation) are able to be used within a digital soil mapping framework where there is a necessity to define a stated level of prediction confidence.</p>

<p>With universal kriging, this is the restriction of the linear model (which in many situations could be the best model). For empirical approaches to uncertainty quantification, this restriction does not exist. Further to this, the localized allocation of prediction limits i.e. in given landscape situations provides a means to identify areas where mapping is accurate and where it is not so much. Often this is a function of the sampling density. This explicit allocation of prediction intervals may assist with the future design of soil sampling programs.</p>

<p>In the approach to be described, the partitioning is a “hard” partition as opposed to <a href="/DSM_book/pages/uncerts/fuzzy/">a ‘soft’ or ‘fuzzy’ partition approach</a>.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="defining-the-model-parameters-">Defining the model parameters <a id="s-2"></a></h3>

<p>In this example we will use the Cubist model regression model, and then define the subsequent prediction intervals.</p>

<p>First we load libraries, data and then prepare it for analysis.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Libraries</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ithir</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">MASS</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">terra</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">Cubist</span><span class="p">)</span><span class="w">

</span><span class="c1"># point data</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">HV_subsoilpH</span><span class="p">)</span><span class="w">

</span><span class="c1"># Start afresh round pH data to 2 decimal places</span><span class="w">
</span><span class="n">HV_subsoilpH</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">HV_subsoilpH</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">

</span><span class="c1"># remove already intersected data</span><span class="w">
</span><span class="n">HV_subsoilpH</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">HV_subsoilpH</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">]</span><span class="w">

</span><span class="c1"># add an id column</span><span class="w">
</span><span class="n">HV_subsoilpH</span><span class="o">$</span><span class="n">id</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">HV_subsoilpH</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="c1"># re-arrange order of columns</span><span class="w">
</span><span class="n">HV_subsoilpH</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">HV_subsoilpH</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">4</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">)]</span><span class="w">

</span><span class="c1"># Change names of coordinate columns</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">HV_subsoilpH</span><span class="p">)[</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="s2">"y"</span><span class="p">)</span><span class="w">
</span><span class="c1"># save a copy of coordinates</span><span class="w">
</span><span class="n">HV_subsoilpH</span><span class="o">$</span><span class="n">x</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">HV_subsoilpH</span><span class="o">$</span><span class="n">x</span><span class="w">
</span><span class="n">HV_subsoilpH</span><span class="o">$</span><span class="n">y</span><span class="m">2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">HV_subsoilpH</span><span class="o">$</span><span class="n">y</span><span class="w">

</span><span class="c1"># convert data to sf object</span><span class="w">
</span><span class="n">HV_subsoilpH</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sf</span><span class="o">::</span><span class="n">st_as_sf</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HV_subsoilpH</span><span class="p">,</span><span class="w"> </span><span class="n">coords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"x"</span><span class="p">,</span><span class="w"> </span><span class="s2">"y"</span><span class="p">))</span><span class="w">

</span><span class="c1"># grids (covariate rasters from ithir package)</span><span class="w">
</span><span class="n">hv.sub.rasters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">system.file</span><span class="p">(</span><span class="s2">"extdata/"</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ithir"</span><span class="p">),</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hunterCovariates_sub"</span><span class="p">,</span><span class="w">
</span><span class="n">full.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">

</span><span class="c1"># read them into R as SpatRaster objects</span><span class="w">
</span><span class="n">hv.sub.rasters</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">terra</span><span class="o">::</span><span class="n">rast</span><span class="p">(</span><span class="n">hv.sub.rasters</span><span class="p">)</span><span class="w">

</span><span class="c1"># extract covariate data</span><span class="w">
</span><span class="n">DSM_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">terra</span><span class="o">::</span><span class="n">extract</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hv.sub.rasters</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HV_subsoilpH</span><span class="p">,</span><span class="w"> </span><span class="n">bind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"simple"</span><span class="p">)</span><span class="w">
</span><span class="n">DSM_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">)</span><span class="w">

</span><span class="c1"># check for NA values</span><span class="w">
</span><span class="n">which</span><span class="p">(</span><span class="o">!</span><span class="n">complete.cases</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">))</span><span class="w">

</span><span class="c1">## integer(0)</span><span class="w">

</span><span class="n">DSM_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DSM_data</span><span class="p">[</span><span class="n">complete.cases</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1"># subset data for modeling</span><span class="w">
</span><span class="n">set.seed</span><span class="p">(</span><span class="m">1000</span><span class="p">)</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">),</span><span class="w"> </span><span class="m">0.7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">))</span><span class="w">
</span><span class="n">DSM_data_cal</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DSM_data</span><span class="p">[</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># calibration</span><span class="w">
</span><span class="n">DSM_data_val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DSM_data</span><span class="p">[</span><span class="o">-</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">  </span><span class="c1"># validation</span><span class="w">
</span></code></pre></div></div>

<p>Note that the nature of the data sometimes make demonstration of an example a little difficult. Subsequently, some prior analysis was performed of the model fitting in order to ensure that at least one data partition was formed. Therefore using the below data configuration as defined through the <code class="highlighter-rouge">set.seed(1000)</code> randomisation setting and specific covariate data selections should yield two cubist model partitions or rulesets.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Cubist model</span><span class="w">
</span><span class="n">hv.cub.Exp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cubist</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data_cal</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="m">11</span><span class="p">,</span><span class="w"> </span><span class="m">13</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">)],</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="p">,</span><span class="w">
</span><span class="n">cubistControl</span><span class="p">(</span><span class="n">unbiased</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">rules</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">extrapolation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"outcome"</span><span class="p">),</span><span class="w"> </span><span class="n">committees</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">hv.cub.Exp</span><span class="p">)</span><span class="w">

</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Call:</span><span class="w">
</span><span class="c1">## cubist.default(x = DSM_data_cal[, c(5, 11, 13, 15)], y</span><span class="w">
</span><span class="c1">##  = DSM_data_cal$pH60_100cm, committees = 1, control = cubistControl(unbiased</span><span class="w">
</span><span class="c1">##  = TRUE, rules = 10, extrapolation = 5, sample = 0, label = "outcome"))</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Cubist [Release 2.07 GPL Edition]  Wed Sep 20 22:20:07 2023</span><span class="w">
</span><span class="c1">## ---------------------------------</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">##     Target attribute `outcome'</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Read 354 cases (5 attributes) from undefined.data</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Model:</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">##   Rule 1: [336 cases, mean 6.443, range 3.44 to 9.74, est err 1.025]</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">##     if</span><span class="w">
</span><span class="c1">##  MRVBF &gt; 0.004846</span><span class="w">
</span><span class="c1">##     then</span><span class="w">
</span><span class="c1">##  outcome = 3.978 + 0.028 AACN + 0.38 MRVBF + 0.082 TWI + 0.04 Slope</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">##   Rule 2: [18 cases, mean 8.018, range 6.26 to 9.45, est err 0.434]</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">##     if</span><span class="w">
</span><span class="c1">##  MRVBF &lt;= 0.004846</span><span class="w">
</span><span class="c1">##     then</span><span class="w">
</span><span class="c1">##  outcome = 8.686 + 471.23 MRVBF - 0.0236 AACN</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Evaluation on training data (354 cases):</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">##     Average  |error|              1.222</span><span class="w">
</span><span class="c1">##     Relative |error|               1.08</span><span class="w">
</span><span class="c1">##     Correlation coefficient        0.22</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">##  Attribute usage:</span><span class="w">
</span><span class="c1">##    Conds  Model</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">##    100%   100%    MRVBF</span><span class="w">
</span><span class="c1">##           100%    AACN</span><span class="w">
</span><span class="c1">##            95%    Slope</span><span class="w">
</span><span class="c1">##            95%    TWI</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Time: 0.0 secs</span><span class="w">
</span></code></pre></div></div>

<p>Assessing the goodness of fit of this model, we use the <code class="highlighter-rouge">goof</code> function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## goodness of fit (calibration)</span><span class="w">
</span><span class="n">goof</span><span class="p">(</span><span class="n">observed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="p">,</span><span class="w"> </span><span class="n">predicted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">hv.cub.Exp</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data_cal</span><span class="p">))</span><span class="w">

</span><span class="c1">##          R2 concordance      MSE     RMSE         bias</span><span class="w">
</span><span class="c1">## 1 0.2088674   0.3432409 1.458209 1.207563 0.0001963093</span><span class="w">
</span></code></pre></div></div>

<p>Two things we want to save from this process are the model residuals and the expression for each data case as to which partition or ruleset it belongs to. To do this second step we need to take note of the partitioning variables and their threshold values and use indexing to attribute each case to its ruleset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># append rule specification to data</span><span class="w">
</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">rule_spec</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">MRVBF</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.004846</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">rule_spec</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">MRVBF</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0.004846</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w">

</span><span class="c1">## Model residuals</span><span class="w">
</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">residual</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">hv.cub.Exp</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data_cal</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p><a href="#top">Back to top</a></p>

<h3 id="within-ruleset-prediction-limits-">Within ruleset prediction limits <a id="s-3"></a></h3>

<p>With a model defined, it is now necessary to estimate the within partition prediction limits. While we may only want to map the lower 5<sup>th</sup> and upper 95<sup>th</sup> prediction limits, we also want to get at the sensitivity of the uncertainty quantifications which calls for the evaluation of quantiles for a range of confidence levels (in this case sequentially from 5% to 99%) for calculation of the PICP. This is done using the <code class="highlighter-rouge">quantile</code> function and is performed for each ruleset.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># distribution of residuals in each rule set</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">residual</span><span class="p">[</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Residuals ruleset 1"</span><span class="p">)</span><span class="w">

</span><span class="n">hist</span><span class="p">(</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">residual</span><span class="p">[</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Residuals ruleset 2"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Quantiles of residual distribution within each ruleset Rule 1</span><span class="w">
</span><span class="n">r</span><span class="m">1</span><span class="n">.q</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">residual</span><span class="p">[</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">],</span><span class="w"> </span><span class="n">probs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.005</span><span class="p">,</span><span class="w"> </span><span class="m">0.995</span><span class="p">,</span><span class="w"> </span><span class="m">0.0125</span><span class="p">,</span><span class="w"> </span><span class="m">0.9875</span><span class="p">,</span><span class="w"> </span><span class="m">0.025</span><span class="p">,</span><span class="w"> </span><span class="m">0.975</span><span class="p">,</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="m">0.45</span><span class="p">,</span><span class="w"> </span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0.475</span><span class="p">,</span><span class="w"> </span><span class="m">0.525</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="w">
</span><span class="n">r</span><span class="m">1</span><span class="n">.q</span><span class="w">

</span><span class="c1">##        0.5%       99.5%       1.25%      98.75%        2.5%       97.5% </span><span class="w">
</span><span class="c1">## -2.35907828  3.18669415 -2.11623531  3.10336920 -1.90018377  2.91098968 </span><span class="w">
</span><span class="c1">##          5%         95%         10%         90%         20%         80% </span><span class="w">
</span><span class="c1">## -1.69229583  2.44896853 -1.39467810  1.77711057 -1.05917666  1.03383651 </span><span class="w">
</span><span class="c1">##         30%         70%         40%         60%         45%         55% </span><span class="w">
</span><span class="c1">## -0.79152037  0.59774065 -0.56821804  0.15932105 -0.35169148 -0.01512939 </span><span class="w">
</span><span class="c1">##       47.5%       52.5% </span><span class="w">
</span><span class="c1">## -0.29393916 -0.12533224</span><span class="w">

</span><span class="c1"># Rule 2</span><span class="w">
</span><span class="n">r</span><span class="m">2</span><span class="n">.q</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">residual</span><span class="p">[</span><span class="n">DSM_data_cal</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">],</span><span class="w"> </span><span class="n">probs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">0.005</span><span class="p">,</span><span class="w"> </span><span class="m">0.995</span><span class="p">,</span><span class="w"> </span><span class="m">0.0125</span><span class="p">,</span><span class="w"> </span><span class="m">0.9875</span><span class="p">,</span><span class="w"> </span><span class="m">0.025</span><span class="p">,</span><span class="w"> </span><span class="m">0.975</span><span class="p">,</span><span class="w"> </span><span class="m">0.05</span><span class="p">,</span><span class="w"> </span><span class="m">0.95</span><span class="p">,</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="m">0.9</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">,</span><span class="w"> </span><span class="m">0.8</span><span class="p">,</span><span class="w"> </span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="m">0.7</span><span class="p">,</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="m">0.6</span><span class="p">,</span><span class="w"> </span><span class="m">0.45</span><span class="p">,</span><span class="w"> </span><span class="m">0.55</span><span class="p">,</span><span class="w"> </span><span class="m">0.475</span><span class="p">,</span><span class="w"> </span><span class="m">0.525</span><span class="p">),</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">7</span><span class="p">)</span><span class="w">
</span><span class="n">r</span><span class="m">2</span><span class="n">.q</span><span class="w">

</span><span class="c1">##        0.5%       99.5%       1.25%      98.75%        2.5%       97.5% </span><span class="w">
</span><span class="c1">## -0.91812929  0.78924818 -0.85184640  0.73841167 -0.74137491  0.65368415 </span><span class="w">
</span><span class="c1">##          5%         95%         10%         90%         20%         80% </span><span class="w">
</span><span class="c1">## -0.52043193  0.48422911 -0.37243120  0.36673757 -0.29524641  0.17231533 </span><span class="w">
</span><span class="c1">##         30%         70%         40%         60%         45%         55% </span><span class="w">
</span><span class="c1">## -0.16111519  0.13421975 -0.05547775  0.10625404  0.05552533  0.09982510 </span><span class="w">
</span><span class="c1">##       47.5%       52.5% </span><span class="w">
</span><span class="c1">##  0.09317083  0.09703764</span><span class="w">
</span></code></pre></div></div>

<p>Despite many more cases belong to one ruleset compared to the other, the prediction limits for each partition of the data are quite different from each other. This goes some way to understanding that prediction uncertainty ranges are certainly not spatially uniform. In some areas of the landscape we might expect to predict some soil attribute rather accurately, but in other landscape positions the relationships are more complex.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="mapping-predictions-and-model-uncertainties-">Mapping predictions and model uncertainties <a id="s-4"></a></h3>

<p>The creation of the model prediction map brings no new surprises in approach. For the mapping of prediction limits however, we basically need to partition the map area based on the given variables and their thresholds, and then within each area, apply the specific model error ranges for the 90% confidence level. The <code class="highlighter-rouge">terra::ifel</code> function is particularly helpful in advancing this process.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## MAPPING cubist model prediction</span><span class="w">
</span><span class="n">map.cubist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">terra</span><span class="o">::</span><span class="n">predict</span><span class="p">(</span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hv.sub.rasters</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">hv.cub.Exp</span><span class="p">)</span><span class="w">

</span><span class="c1"># note there is a need to mask are the area outside soil mapping boundary</span><span class="w">
</span><span class="n">msk</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">terra</span><span class="o">::</span><span class="n">ifel</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">hv.sub.rasters</span><span class="p">[[</span><span class="m">1</span><span class="p">]]),</span><span class="w"> </span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">map.cubist</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">terra</span><span class="o">::</span><span class="n">mask</span><span class="p">(</span><span class="n">map.cubist</span><span class="p">,</span><span class="w"> </span><span class="n">msk</span><span class="p">,</span><span class="w"> </span><span class="n">inverse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">F</span><span class="p">)</span><span class="w">

</span><span class="c1"># map the rule set distribution</span><span class="w">
</span><span class="n">mapped.ruleset</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ifel</span><span class="p">(</span><span class="n">hv.sub.rasters</span><span class="p">[[</span><span class="s2">"MRVBF"</span><span class="p">]]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.004846</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">

</span><span class="c1"># upper and lower prediction intervals upper</span><span class="w">
</span><span class="n">map.cubist.upl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">terra</span><span class="o">::</span><span class="n">ifel</span><span class="p">(</span><span class="n">mapped.ruleset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">map.cubist</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="m">1</span><span class="n">.q</span><span class="p">[</span><span class="m">8</span><span class="p">],</span><span class="w"> </span><span class="n">map.cubist</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="m">2</span><span class="n">.q</span><span class="p">[</span><span class="m">8</span><span class="p">])</span><span class="w">

</span><span class="c1"># lower</span><span class="w">
</span><span class="n">map.cubist.lpl</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">terra</span><span class="o">::</span><span class="n">ifel</span><span class="p">(</span><span class="n">mapped.ruleset</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">map.cubist</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="m">1</span><span class="n">.q</span><span class="p">[</span><span class="m">7</span><span class="p">],</span><span class="w"> </span><span class="n">map.cubist</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">r</span><span class="m">2</span><span class="n">.q</span><span class="p">[</span><span class="m">7</span><span class="p">])</span><span class="w">

</span><span class="c1"># Prediction interval range</span><span class="w">
</span><span class="n">map.cubist.pir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">map.cubist.upl</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">map.cubist.lpl</span><span class="w">
</span></code></pre></div></div>

<p>Plotting each of the maps.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## color ramp</span><span class="w">
</span><span class="n">phCramp</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#d53e4f"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#f46d43"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fdae61"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#fee08b"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#ffffbf"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#e6f598"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#abdda4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#66c2a5"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#3288bd"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#5e4fa2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#542788"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#2d004b"</span><span class="p">)</span><span class="w">
</span><span class="n">brk</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="o">:</span><span class="m">14</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">

</span><span class="n">plot</span><span class="p">(</span><span class="n">map.cubist.lpl</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"90% Lower prediction limit"</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brk</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phCramp</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">map.cubist</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Prediction"</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brk</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phCramp</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">map.cubist.upl</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"90% Upper prediction limit"</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">brk</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">phCramp</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">map.cubist.pir</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Prediction limit range"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">terrain.colors</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6.5</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">axes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">6.5</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<figure>
<img src="/images/dsm_book/P7_mapping_partition.png" alt="rconsole" />
<figcaption>
Soil pH predictions, prediction limits and prediction interval range
derived using cubist model and empirical data partition approach.
</figcaption>
</figure>

<p>For interests sake the map of the spatial distribution of each ruleset
is shown below. Only a relatively small area is attributed to ruleset 2.</p>

<figure>
<img src="/images/dsm_book/P7_partition_map_ruleset.png" alt="rconsole" />
<figcaption>
Spatial distributions of fitted cubist model rulesets.
</figcaption>
</figure>

<p><a href="#top">Back to top</a></p>

<h3 id="evaluating-the-quantification-of-uncertainties-">Evaluating the quantification of uncertainties <a id="s-1"></a></h3>

<p>For out-of-bag model evaluation we assess both the quality of the predictions and the quantification of uncertainty. Below we assess the validation of the cubist model.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Model evaluation with out-of-bag cases Cubist model prediction</span><span class="w">
</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">model_pred</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">hv.cub.Exp</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="p">)</span><span class="w">

</span><span class="c1"># Evaluation</span><span class="w">
</span><span class="n">goof</span><span class="p">(</span><span class="n">observed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="p">,</span><span class="w"> </span><span class="n">predicted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">model_pred</span><span class="p">)</span><span class="w">

</span><span class="c1">##          R2 concordance      MSE    RMSE       bias</span><span class="w">
</span><span class="c1">## 1 0.1387573    0.274822 1.494898 1.22266 0.09989099</span><span class="w">
</span></code></pre></div></div>

<p>The first step in estimating the uncertainty about the validation points
is to evaluate which ruleset each case belongs to.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># append rule specification to data</span><span class="w">
</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">
</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">MRVBF</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0.004846</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">MRVBF</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">0.004846</span><span class="p">)]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="n">summary</span><span class="p">(</span><span class="n">as.factor</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="p">))</span><span class="w">

</span><span class="c1">##   1   2 </span><span class="w">
</span><span class="c1">## 145   7</span><span class="w">
</span></code></pre></div></div>

<p>Then we can define the prediction interval that corresponds to each
observation for each level of confidence.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># upper and lower prediction limits upper</span><span class="w">
</span><span class="n">ulMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">r</span><span class="m">1</span><span class="n">.q</span><span class="p">))</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">ulMat</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r</span><span class="m">1</span><span class="n">.q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
</span><span class="n">ulMat</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r</span><span class="m">2</span><span class="n">.q</span><span class="p">[</span><span class="n">i</span><span class="p">]}</span><span class="w">

</span><span class="c1"># lower</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">ulMat</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r</span><span class="m">1</span><span class="n">.q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w">
</span><span class="n">ulMat</span><span class="p">[</span><span class="n">which</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">),</span><span class="w"> </span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">r</span><span class="m">2</span><span class="n">.q</span><span class="p">[</span><span class="n">i</span><span class="p">]}</span><span class="w">

</span><span class="c1"># upper and lower prediction limits</span><span class="w">
</span><span class="n">ULpreds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ulMat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">model_pred</span><span class="w">
</span><span class="n">ULpreds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">ULpreds</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">ULpreds</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">r</span><span class="m">1</span><span class="n">.q</span><span class="p">)</span><span class="w">
</span><span class="n">DSM_data_val</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="p">,</span><span class="w"> </span><span class="n">ULpreds</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>The PICP estimates appear to correspond quite well with the respective
confidence levels. This can be observed from the plot on Figure below
too.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># PICP</span><span class="w">
</span><span class="n">bMat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">matrix</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">ULpreds</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">ncol</span><span class="p">(</span><span class="n">ULpreds</span><span class="p">)</span><span class="o">/</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">cnt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span><span class="w">
</span><span class="n">bMat</span><span class="p">[,</span><span class="w"> </span><span class="n">cnt</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">ULpreds</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">ULpreds</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">])</span><span class="w">
</span><span class="n">cnt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">1</span><span class="p">}</span><span class="w">

</span><span class="c1"># plotting</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">))</span><span class="w">
</span><span class="n">cs</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">99</span><span class="p">,</span><span class="w"> </span><span class="m">97.5</span><span class="p">,</span><span class="w"> </span><span class="m">95</span><span class="p">,</span><span class="w"> </span><span class="m">90</span><span class="p">,</span><span class="w"> </span><span class="m">80</span><span class="p">,</span><span class="w"> </span><span class="m">60</span><span class="p">,</span><span class="w"> </span><span class="m">40</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="w"> </span><span class="p">((</span><span class="n">colSums</span><span class="p">(</span><span class="n">bMat</span><span class="p">)</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">bMat</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"PICP"</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"confidence level"</span><span class="p">)</span><span class="w">
</span><span class="c1"># draw 1:1 line</span><span class="w">
</span><span class="n">abline</span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
<img src="/images/dsm_book/PICP_partition.png" alt="rconsole" />
<figcaption>
Plot of PICP and confidence level based on cubist model and data
partition uncertainty approach.
</figcaption>
</figure>

<p>Looking at the quantiles of the prediction interval ranges we can see the effect that data partitioning has which is distinct grouping of the uncertainty.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">quantile</span><span class="p">(</span><span class="n">ULpreds</span><span class="p">[,</span><span class="w"> </span><span class="m">8</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ULpreds</span><span class="p">[,</span><span class="w"> </span><span class="m">7</span><span class="p">])</span><span class="w">

</span><span class="c1">##       0%      25%      50%      75%     100% </span><span class="w">
</span><span class="c1">## 1.004661 4.141264 4.141264 4.141264 4.141264</span><span class="w">
</span></code></pre></div></div>

<p>The demonstration of this method may not be too helpful with the data at hand, and this example should only be used for illustration of concept rather than as a promotion or demotion of the method. Due to the relatively small number of cases in ruleset 2 compared with ruleset 1, we might expect to observe clear differences in the confidence in the uncertainty quantification between the different rulesets.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># PICP by rule set for 90% confidence rule 1</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="p">[</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">`95%`</span><span class="p">[</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="p">[</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">`5%`</span><span class="p">[</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">])</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="p">[</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">])</span><span class="w">

</span><span class="c1">## [1] 0.9241379</span><span class="w">

</span><span class="c1"># rule 2</span><span class="w">
</span><span class="nf">sum</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="p">[</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">`95%`</span><span class="p">[</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">pH60_100cm</span><span class="p">[</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">`5%`</span><span class="p">[</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">])</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">DSM_data_val</span><span class="p">[</span><span class="n">DSM_data_val</span><span class="o">$</span><span class="n">rule_spec</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="p">])</span><span class="w">

</span><span class="c1">## [1] 0.4285714</span><span class="w">
</span></code></pre></div></div>

<p>Despite the small number of cases in ruleset two, we can still be encouraged that just under half the cases fit within their relatively narrow prediction envelopes for the 90% confidence level.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="references">References</h3>

<p>Malone, B P, B Minasny, N P Odgers, and A B McBratney. 2014. “Using
Model Averaging to Combine Soil Property Rasters from Legacy Soil Maps
and from Point Data.” <em>Geoderma</em> 232-234: 34–44.</p>

<p><a href="#top">Back to top</a></p>

      <footer class="entry-meta">
        <span>Updated on <span class="entry-date date published updated"><time datetime="2023-09-20">September 20, 2023</time></span></span>
        <span class="author vcard"><span class="fn">Smart Digital Agriculture</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/DSM_book/pages/uncerts/partition/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/DSM_book/pages/uncerts/partition/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/DSM_book/pages/uncerts/partition/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
    <!--<span>&copy; 2025 Smart Digital Agriculture. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>-->

<footer role="contentinfo">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="mailto:malone.brendan1001@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/brendo1001">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://twitter.com/soilmalone">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Smart Digital Agriculture 2025, All Rights Reserved.</p>
            </div>
        </div>
    </div>
</footer>

</div><!-- /.footer-wrapper -->

<!-- JQuery JavaScript -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>

<!-- Bootstrap Core JavaScript -->
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<!-- Clean Blog JavaScript -->
<script src="/assets/js/clean-blog.min.js"></script>

<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87285093-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


<!-- Math equation support by MathJax -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: {
            equationNumbers: { autoNumber: "all" },
            inlineMath: [['$','$'],['\\(','\\)']],
        },
        "HTML-CSS": {
            availableFonts: ["TeX"],
            preferredFont: "TeX",
        },
    });
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>




</body>
</html>
