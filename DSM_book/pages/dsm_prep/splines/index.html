<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Preparatory and exploratory data analysis for digital soil mapping &#8211; Smart Digital Agriculture</title>
<meta name="description" content="">


<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="Preparatory and exploratory data analysis for digital soil mapping">
<meta name="twitter:description" content="">
<meta name="twitter:creator" content="@soilmalone">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Preparatory and exploratory data analysis for digital soil mapping">
<meta property="og:description" content="">
<meta property="og:url" content="/DSM_book/pages/dsm_prep/splines/">
<meta property="og:site_name" content="Smart Digital Agriculture">

<meta name="google-site-verification" content="googledd99b1430269a639.html">



<link rel="canonical" href="/DSM_book/pages/dsm_prep/splines/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Smart Digital Agriculture Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="/assets/css/bootstrap.min.css">
<!-- Clean Blog CSS -->
<link rel="stylesheet" href="/assets/css/clean-blog.css">
<!-- HPSTR main CSS -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Custom Fonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Viga|Ubuntu:700' rel='stylesheet' type='text/css'>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

</head>

<body id="page" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Smart Digital Agriculture</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    
                    <li><a href="/" >Home</a></li>
                
                    
                    <li><a href="/publications/" >Publications</a></li>
                
                    
                    <li><a href="/software/" >Software</a></li>
                
                    
                    <li><a href="/blog/" >Journal Digests</a></li>
                
                    
                    <li><a href="/UseCases/" >Blog</a></li>
                
                    
                    <li><a href="/DSM_book/" >Using R for Digital Soil Mapping</a></li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Page Header -->
<header class="intro-header" style="background-image: url('/images/pedometric2017.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
                    <h1>Preparatory and exploratory data analysis for digital soil mapping</h1>
                    
                        <hr class="small">
                        <span class="subheading"></span>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<!--

-->

<div id="main" role="main">
  <article class="hentry">
    <!--
    <header class="header-title">
      <div class="header-title-wrap">
        <h1 class="entry-title">Preparatory and exploratory data analysis for digital soil mapping</h1>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~11 minutes
        </p>
        
      </div>
    </header>
    -->
    <div class="entry-content">
      <h4 id="code-">CODE: <a id="s-1"></a></h4>
<p><a href="/DSM_book/rcode/P4_DSM_prep.R">Get the code used in the sections about preparatory and exploratory data analysis</a></p>

<h3 id="soil-depth-functions">Soil depth functions</h3>

<p><a href="#s-3">Skip to fitting splines to multiple soil profiles</a></p>

<h3 id="soil-depth-functions-1">Soil depth functions</h3>

<p>The traditional horizon-based sampling method divides a soil profile into discrete layers based on easily observed field properties (e.g., color, texture; Bishop et al. 1999). Each horizon’s bulk sample is assumed to represent the average value of a soil attribute over that depth interval.</p>

<p>However, this approach has two main drawbacks:</p>

<ol>
  <li><strong>Stepped profiles.</strong> Soils vary continuously with depth, but horizon-averaging produces a discontinuous, “stepped” representation.</li>
  <li><strong>Inconsistent depths.</strong> Horizon boundaries differ from profile to profile, making it hard to obtain harmonized observations at fixed depths for modelling.</li>
</ol>

<p>Some one-step models (Orton et al. 2016; Poggio &amp; Gimona 2014) interpolate directly, but most practitioners use a two-step approach:</p>

<ol>
  <li><strong>Fit a continuous, mass-preserving spline</strong> (equal-area quadratic spline) to each profile.</li>
  <li><strong>Extract harmonized values</strong> at user-defined depth intervals (e.g. 0–5 cm, 5–15 cm, …, 100–200 cm; GlobalSoilMap.net specification, Arrouays et al. 2014).</li>
</ol>

<p>A mass-preserving spline has two advantages:</p>

<ul>
  <li><strong>Data integrity.</strong> Total “mass” (integral) over the profile is preserved and recoverable by integration.</li>
  <li><strong>User-defined depths.</strong> Spline parameters correspond directly to the soil attribute values at standard depths, enabling easy harmonization across many profiles.</li>
</ul>

<p>Below, we’ll apply this method to legacy horizon data: fitting splines to each profile and then extracting harmonized values for downstream DSM modelling.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="fit-mass-preserving-splines-with-r">Fit mass preserving splines with <code class="highlighter-rouge">R</code></h3>

<p><a href="#s-3">Skip to fitting splines to multiple soil profiles</a></p>

<p>The following example shows how to fit a mass-preserving spline to a single soil profile’s carbon-density measurements, from the surface down to its maximum observed depth.</p>

<p>You can choose to fit the spline all the way to the profile’s deepest measurement or to any shallower depth. We use the <code class="highlighter-rouge">ea_spline</code> function from the <strong>ithir</strong> package to perform this fitting.</p>

<p>For details on additional arguments and input types, consult the help file (<code class="highlighter-rouge">?ea_spline</code>). Besides <code class="highlighter-rouge">data.frame</code>, <code class="highlighter-rouge">ea_spline</code> also accepts <strong>aqp</strong>’s <code class="highlighter-rouge">SoilProfileCollection</code> objects when you need more complex profile structures.</p>

<p>In this section, we’ll work with the <code class="highlighter-rouge">data.frame</code> called <code class="highlighter-rouge">oneProfile</code> (included in <strong>ithir</strong>). Before running the spline, load <strong>ithir</strong> and any other supporting packages you’ll need:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#Load ithir library</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ithir</span><span class="p">)</span><span class="w">

</span><span class="c1">#ithir dataset</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">oneProfile</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">oneProfile</span><span class="p">)</span><span class="w">

</span><span class="c1">## 'data.frame':    8 obs. of  4 variables:</span><span class="w">
</span><span class="c1">##  $ Soil.ID       : int  1 1 1 1 1 1 1 1</span><span class="w">
</span><span class="c1">##  $ Upper.Boundary: int  0 10 30 50 70 120 250 350</span><span class="w">
</span><span class="c1">##  $ Lower.Boundary: int  10 20 40 60 80 130 260 360</span><span class="w">
</span><span class="c1">##  $ C.kg.m3.      : num  20.72 11.71 8.23 6.3 2.4 ...</span><span class="w">
</span></code></pre></div></div>

<p>As you can see above, the data table shows the soil depth information and carbon density values for a single soil profile. Note the discontinuity of the observed depth intervals which can also be observed in the figure below.</p>

<figure>
    <img src="/images/dsm_book/splinePlot1.png" alt="rconsole" />
    <figcaption> Soil profile plot of the `oneProfile` data. Note this figure was produced using the `plot_soilProfile` function from `ithir`.</figcaption>
</figure>

<p>The <code class="highlighter-rouge">ea_spline</code> function fits a continuous, mass-preserving spline from the soil surface down to your chosen maximum depth. It interpolates smoothly both within observed horizons and across gaps where no measurements exist.</p>

<h4 id="key-parameters">Key parameters</h4>

<ul>
  <li><strong><code class="highlighter-rouge">lam</code></strong> (λ): Controls spline smoothness.
    <ul>
      <li>Larger values → more rigid (smoother) curves</li>
      <li>Smaller values → more flexible curves that follow observations closely</li>
      <li><em>Default:</em> 0.1 (a good starting point for most soil attributes)</li>
      <li><strong>Tip:</strong> Perform a simple sensitivity analysis to select an optimal λ for your data.</li>
    </ul>
  </li>
  <li><strong><code class="highlighter-rouge">d</code></strong>: Defines the target depth intervals for harmonized outputs.
    <ul>
      <li>Specified as a matrix or vector of breakpoints</li>
      <li><em>Default intervals (GlobalSoilMap.net):</em> 0–5 cm, 5–15 cm, 15–30 cm, 30–60 cm, 60–100 cm, 100–200 cm</li>
      <li><strong>Tip:</strong> Customize these to match your project’s depth requirements.</li>
    </ul>
  </li>
</ul>

<p><strong>Workflow:</strong></p>
<ol>
  <li>Fit the spline to your horizon data.</li>
  <li>Integrate the spline over each interval in <code class="highlighter-rouge">d</code> to obtain harmonized, interval-averaged values.</li>
</ol>

<p>Below is an example script applying these defaults to the <code class="highlighter-rouge">oneProfile</code> data:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">eaFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ithir</span><span class="o">::</span><span class="n">ea_spline</span><span class="p">(</span><span class="n">oneProfile</span><span class="p">,</span><span class="w"> </span><span class="n">var.name</span><span class="o">=</span><span class="s2">"C.kg.m3."</span><span class="p">,</span><span class="w">
        </span><span class="n">d</span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">60</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">200</span><span class="p">)),</span><span class="n">lam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">vlow</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> 
        </span><span class="n">show.progress</span><span class="o">=</span><span class="kc">FALSE</span><span class="w"> </span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">eaFit</span><span class="p">)</span><span class="w">

</span><span class="c1">## List of 4</span><span class="w">
</span><span class="c1">##  $ harmonised    :'data.frame':  1 obs. of  8 variables:</span><span class="w">
</span><span class="c1">##   ..$ id        : num 1</span><span class="w">
</span><span class="c1">##   ..$ 0-5 cm    : num 21.1</span><span class="w">
</span><span class="c1">##   ..$ 5-15 cm   : num 15.8</span><span class="w">
</span><span class="c1">##   ..$ 15-30 cm  : num 9.91</span><span class="w">
</span><span class="c1">##   ..$ 30-60 cm  : num 7.2</span><span class="w">
</span><span class="c1">##   ..$ 60-100 cm : num 2.75</span><span class="w">
</span><span class="c1">##   ..$ 100-200 cm: num 1.72</span><span class="w">
</span><span class="c1">##   ..$ soil depth: num 360</span><span class="w">
</span><span class="c1">##  $ obs.preds     :'data.frame':  8 obs. of  6 variables:</span><span class="w">
</span><span class="c1">##   ..$ Soil.ID       : num [1:8] 1 1 1 1 1 1 1 1</span><span class="w">
</span><span class="c1">##   ..$ Upper.Boundary: num [1:8] 0 10 30 50 70 120 250 350</span><span class="w">
</span><span class="c1">##   ..$ Lower.Boundary: num [1:8] 10 20 40 60 80 130 260 360</span><span class="w">
</span><span class="c1">##   ..$ C.kg.m3.      : num [1:8] 20.72 11.71 8.23 6.3 2.4 ...</span><span class="w">
</span><span class="c1">##   ..$ predicted     : num [1:8] 19.86 12.46 8.27 6.2 2.56 ...</span><span class="w">
</span><span class="c1">##   ..$ FID           : num [1:8] 1 1 1 1 1 1 1 1</span><span class="w">
</span><span class="c1">##  $ splineFitError:'data.frame':  1 obs. of  2 variables:</span><span class="w">
</span><span class="c1">##   ..$ rmse   : num 0.41</span><span class="w">
</span><span class="c1">##   ..$ rmseiqr: num 0.0561</span><span class="w">
</span><span class="c1">##  $ var.1cm       : num [1:200, 1] 21.6 21.4 21.2 20.8 20.3 ...</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">ea_spline</code> function returns a <strong>list</strong> with four elements:</p>

<ol>
  <li>
    <p><strong><code class="highlighter-rouge">harmonised</code></strong> (<code class="highlighter-rouge">data.frame</code>):<br />
Predicted spline estimates averaged over your specified depth intervals.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">obs.preds</code></strong> (<code class="highlighter-rouge">data.frame</code>):<br />
The original horizon measurements combined with spline-predicted values at those exact depths.</p>
  </li>
  <li><strong><code class="highlighter-rouge">splineFitError</code></strong> (<code class="highlighter-rouge">data.frame</code>):
    <ul>
      <li><strong><code class="highlighter-rouge">rmse</code></strong>: root-mean-square error between observations and predictions</li>
      <li><strong><code class="highlighter-rouge">nrmse</code></strong>: RMSE normalized by the interquartile range (IQR), providing a scale-independent error metric</li>
    </ul>
  </li>
  <li><strong><code class="highlighter-rouge">var.1cm</code></strong> (<code class="highlighter-rouge">matrix</code>):<br />
High-resolution predictions at 1 cm increments down to the maximum depth. Rows correspond to depth (cm), columns to individual profiles.</li>
</ol>

<hr />

<p>To visualize spline performance, use the accompanying <strong><code class="highlighter-rouge">plot_ea_spline</code></strong> function. It offers three plot types:</p>

<ul>
  <li><strong>Type 1</strong>: observed data + continuous spline</li>
  <li><strong>Type 2</strong>: observed data + interval means</li>
  <li><strong>Type 3</strong>: combined view (continuous spline + interval means)</li>
</ul>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">1</span><span class="p">))</span><span class="w"> 
</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">){</span><span class="w">
  </span><span class="n">ithir</span><span class="o">::</span><span class="n">plot_ea_spline</span><span class="p">(</span><span class="n">splineOuts</span><span class="o">=</span><span class="n">eaFit</span><span class="p">,</span><span class="w"> 
  </span><span class="n">d</span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">60</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">200</span><span class="p">)),</span><span class="w"> </span><span class="n">maxd</span><span class="o">=</span><span class="m">200</span><span class="p">,</span><span class="w"> 
  </span><span class="n">type</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">plot.which</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="o">=</span><span class="s2">"carbon density"</span><span class="p">)}</span><span class="w">
</span></code></pre></div></div>

<p>The <code class="highlighter-rouge">plot_ea_spline</code> function provides three visualization modes, controlled by the <code class="highlighter-rouge">type</code> argument:</p>

<ul>
  <li><strong>Type 1</strong>: Observed horizon data with the continuous spline curve (default).</li>
  <li><strong>Type 2</strong>: Observed data with interval-averaged spline values at your specified depths.</li>
  <li><strong>Type 3</strong>: A combined view showing both the continuous spline and the interval averages.</li>
</ul>

<p>While <code class="highlighter-rouge">plot_ea_spline</code> offers limited customization of axes, labels, or colors, these three themes cover the most common diagnostic needs. The example above loops through all three types, producing a stack of plots like the one shown below.</p>

<figure>
    <img src="/images/dsm_book/splinePlot2.png" alt="rconsole" />
    <figcaption> Soil profile plot of the three type variants from `plot_ea_spline`. Plot 1 is type 1, plot 2 is type 2 and plot 3 is type 3.</figcaption>
</figure>

<p><a href="#top">Back to top</a></p>

<h3 id="fitting-spline-to-multiple-soil-profiles-">Fitting spline to multiple soil profiles. <a id="s-3"></a></h3>

<p>The single-profile example was just a proof of concept. In a typical DSM workflow, you’ll fit splines to many profiles at once. The steps are identical:</p>

<ol>
  <li><strong>Prepare your data</strong>
    <ul>
      <li>Combine all profiles into one <code class="highlighter-rouge">data.frame</code> or <code class="highlighter-rouge">SoilProfileCollection</code>.</li>
      <li>Include a unique ID column (numeric, character, or mixed) so each profile is processed separately.</li>
    </ul>
  </li>
  <li>
    <p><strong>Run the spline fitting</strong><br />
Call <code class="highlighter-rouge">ea_spline()</code> on your assembled dataset, specifying the object (<code class="highlighter-rouge">obj</code>), the target variable (<code class="highlighter-rouge">var.name</code>), depth intervals (<code class="highlighter-rouge">d</code>), smoothing parameter (<code class="highlighter-rouge">lam</code>), minimum value (<code class="highlighter-rouge">vlow</code>), and set <code class="highlighter-rouge">show.progress = TRUE</code> to track progress.</p>
  </li>
  <li><strong>Inspect results</strong>
    <ul>
      <li><code class="highlighter-rouge">eaFit$harmonised</code>: harmonized values per profile &amp; depth</li>
      <li><code class="highlighter-rouge">eaFit$obs.preds</code>: observed vs. predicted per horizon</li>
      <li><code class="highlighter-rouge">eaFit$splineFitError</code>: RMSE &amp; nRMSE for each profile</li>
      <li><code class="highlighter-rouge">eaFit$var.1cm</code>: high-resolution spline curves</li>
    </ul>
  </li>
</ol>

<p>For this demo, download <a href="/DSM_book/data/Carbon_10sites.csv">Carbon_10sites.csv</a>, which contains 10 profiles of soil carbon measurements.</p>

<blockquote>
  <p><strong>Performance note:</strong> Because <code class="highlighter-rouge">ea_spline</code> uses efficient internal calculations and minimal external dependencies, you can process tens of thousands of profiles in a few minutes. The primary runtime driver is simply the total number of profiles and depth intervals.</p>
</blockquote>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># load data</span><span class="w">
</span><span class="n">Carbon_10sites</span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"~/Carbon_10sites.csv"</span><span class="p">)</span><span class="w">

</span><span class="c1"># fit spline to each profile</span><span class="w">
</span><span class="n">eaFit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ithir</span><span class="o">::</span><span class="n">ea_spline</span><span class="p">(</span><span class="n">obj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Carbon_10sites</span><span class="p">,</span><span class="w">
</span><span class="n">var.name</span><span class="o">=</span><span class="s2">"C.kg.m3."</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">,</span><span class="m">15</span><span class="p">,</span><span class="m">30</span><span class="p">,</span><span class="m">60</span><span class="p">,</span><span class="m">100</span><span class="p">,</span><span class="m">200</span><span class="p">)),</span><span class="n">lam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.1</span><span class="p">,</span><span class="w"> </span><span class="n">vlow</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">show.progress</span><span class="o">=</span><span class="kc">FALSE</span><span class="w"> </span><span class="p">)</span><span class="w">

</span><span class="n">str</span><span class="p">(</span><span class="n">eaFit</span><span class="p">)</span><span class="w">

</span><span class="c1">## List of 4</span><span class="w">
</span><span class="c1">##  $ harmonised    :'data.frame':  10 obs. of  8 variables:</span><span class="w">
</span><span class="c1">##   ..$ id        : num [1:10] 1 2 3 4 5 6 7 8 9 10</span><span class="w">
</span><span class="c1">##   ..$ 0-5 cm    : num [1:10] 28.78 23.68 12.45 7.69 7.51 ...</span><span class="w">
</span><span class="c1">##   ..$ 5-15 cm   : num [1:10] 18.62 14.67 9.3 6.35 6.94 ...</span><span class="w">
</span><span class="c1">##   ..$ 15-30 cm  : num [1:10] 10.47 6.48 6.6 5.49 6.47 ...</span><span class="w">
</span><span class="c1">##   ..$ 30-60 cm  : num [1:10] 9.22 6.65 5.59 5.58 6 ...</span><span class="w">
</span><span class="c1">##   ..$ 60-100 cm : num [1:10] 5.31 6.13 3.99 4.08 4.41 ...</span><span class="w">
</span><span class="c1">##   ..$ 100-200 cm: num [1:10] 3.13 3.31 1.18 1.85 2.72 ...</span><span class="w">
</span><span class="c1">##   ..$ soil depth: num [1:10] 260 260 260 260 260 259 260 260 253 260</span><span class="w">
</span><span class="c1">##  $ obs.preds     :'data.frame':  62 obs. of  6 variables:</span><span class="w">
</span><span class="c1">##   ..$ Level.Soil.ID : num [1:62] 1 1 1 1 1 1 2 2 2 2 ...</span><span class="w">
</span><span class="c1">##   ..$ Upper.Boundary: num [1:62] 0 10 30 70 120 250 0 10 30 70 ...</span><span class="w">
</span><span class="c1">##   ..$ Lower.Boundary: num [1:62] 8 20 40 80 130 260 10 20 40 80 ...</span><span class="w">
</span><span class="c1">##   ..$ C.kg.m3.      : num [1:62] 28.69 11.94 10.59 5.28 3.76 ...</span><span class="w">
</span><span class="c1">##   ..$ predicted     : num [1:62] 27.6 13.06 10.48 5.35 3.77 ...</span><span class="w">
</span><span class="c1">##   ..$ FID           : num [1:62] 1 1 1 1 1 1 2 2 2 2 ...</span><span class="w">
</span><span class="c1">##  $ splineFitError:'data.frame':  10 obs. of  2 variables:</span><span class="w">
</span><span class="c1">##   ..$ rmse   : num [1:10] 0.642 0.6536 0.1653 0.1098 0.0462 ...</span><span class="w">
</span><span class="c1">##   ..$ rmseiqr: num [1:10] 0.0861 0.2069 0.0321 0.0343 0.0149 ...</span><span class="w">
</span><span class="c1">##  $ var.1cm       : num [1:200, 1:10] 29.9 29.6 29 28.2 27.2 ...</span><span class="w">
</span></code></pre></div></div>

<p>With multiple profiles, the output becomes more intuitive. In particular, the <strong><code class="highlighter-rouge">eaFit$harmonised</code></strong> data frame lists one row per profile, with each column representing the predicted value at a user-specified depth. The <strong><code class="highlighter-rouge">soil.depth</code></strong> column gives each profile’s maximum depth, helping you verify that the harmonized estimates cover the full observed range.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="references">References</h3>

<p>Arrouays, D., McKenzie, N., Hempel, J., Richer de Forges, A., &amp; McBratney, A. (2014). <em>GlobalSoilMap: Basis of the Global Spatial Soil Information System</em>. CRC Press.</p>

<p>Bishop, T. F. A., McBratney, A. B., &amp; Laslett, G. M. (1999). Modelling soil attribute depth functions with equal-area quadratic smoothing splines. <em>Geoderma</em>, 91, 27–45.</p>

<p>Malone, B. P., McBratney, A. B., Minasny, B., &amp; Laslett, G. M. (2009). Mapping continuous depth functions of soil carbon storage and available water capacity. <em>Geoderma</em>, 154, 138–152.</p>

<p>Orton, T. G., Pringle, M. J., &amp; Bishop, T. F. A. (2016). A one-step approach for modelling and mapping soil properties based on profile data sampled over varying depth intervals. <em>Geoderma</em>, 262, 174–186.</p>

<p>Poggio, L., &amp; Gimona, A. (2014). National-scale 3D modelling of soil organic carbon stocks with uncertainty propagation: an example from Scotland. <em>Geoderma</em>, 232–234, 284–299.</p>

<p>Ponce-Hernandez, R., Marriott, F. H. C., &amp; Beckett, P. H. T. (1986). An improved method for reconstructing a soil profile from analysis of a small number of samples. <em>Journal of Soil Science</em>, 37, 455–467.</p>

<p><a href="#top">Back to top</a></p>

      <footer class="entry-meta">
        <span>Updated on <span class="entry-date date published updated"><time datetime="2025-05-22">May 22, 2025</time></span></span>
        <span class="author vcard"><span class="fn">Smart Digital Agriculture</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/DSM_book/pages/dsm_prep/splines/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/DSM_book/pages/dsm_prep/splines/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/DSM_book/pages/dsm_prep/splines/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
    <!--<span>&copy; 2025 Smart Digital Agriculture. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>-->

<footer role="contentinfo">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="mailto:malone.brendan1001@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/brendo1001">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://twitter.com/soilmalone">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Smart Digital Agriculture 2025, All Rights Reserved.</p>
            </div>
        </div>
    </div>
</footer>

</div><!-- /.footer-wrapper -->

<!-- JQuery JavaScript -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>

<!-- Bootstrap Core JavaScript -->
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<!-- Clean Blog JavaScript -->
<script src="/assets/js/clean-blog.min.js"></script>

<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87285093-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


<!-- Math equation support by MathJax -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: {
            equationNumbers: { autoNumber: "all" },
            inlineMath: [['$','$'],['\\(','\\)']],
        },
        "HTML-CSS": {
            availableFonts: ["TeX"],
            preferredFont: "TeX",
        },
    });
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>




</body>
</html>
