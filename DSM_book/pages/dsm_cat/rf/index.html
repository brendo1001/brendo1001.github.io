<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Random forest modelling &#8211; Smart Digital Agriculture</title>
<meta name="description" content="Categorical Variables">


<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="Random forest modelling">
<meta name="twitter:description" content="Categorical Variables">
<meta name="twitter:creator" content="@soilmalone">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Random forest modelling">
<meta property="og:description" content="Categorical Variables">
<meta property="og:url" content="/DSM_book/pages/dsm_cat/rf/">
<meta property="og:site_name" content="Smart Digital Agriculture">

<meta name="google-site-verification" content="googledd99b1430269a639.html">



<link rel="canonical" href="/DSM_book/pages/dsm_cat/rf/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Smart Digital Agriculture Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="/assets/css/bootstrap.min.css">
<!-- Clean Blog CSS -->
<link rel="stylesheet" href="/assets/css/clean-blog.css">
<!-- HPSTR main CSS -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Custom Fonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Viga|Ubuntu:700' rel='stylesheet' type='text/css'>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

</head>

<body id="page" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Smart Digital Agriculture</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    
                    <li><a href="/" >Home</a></li>
                
                    
                    <li><a href="/publications/" >Publications</a></li>
                
                    
                    <li><a href="/software/" >Software</a></li>
                
                    
                    <li><a href="/blog/" >Journal Digests</a></li>
                
                    
                    <li><a href="/UseCases/" >Blog</a></li>
                
                    
                    <li><a href="/DSM_book/" >Using R for Digital Soil Mapping</a></li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Page Header -->
<header class="intro-header" style="background-image: url('/images/pedometric2017.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
                    <h1>Random forest modelling</h1>
                    
                        <hr class="small">
                        <span class="subheading">Categorical Variables</span>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<!--

-->

<div id="main" role="main">
  <article class="hentry">
    <!--
    <header class="header-title">
      <div class="header-title-wrap">
        <h1 class="entry-title">Random forest modelling</h1>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~13 minutes
        </p>
        
      </div>
    </header>
    -->
    <div class="entry-content">
      <ul>
  <li><a href="#s-1">Introduction</a></li>
  <li><a href="#s-2">Data preparation</a></li>
  <li><a href="#s-3">Model fitting</a></li>
  <li><a href="#s-4">Model goodness of fit</a></li>
  <li><a href="#s-5">Applying the model spatially</a></li>
</ul>

<h3 id="introduction-">Introduction <a id="s-1"></a></h3>

<p>Here we will take another look at the Random Forest, which you may be
familiar with now as this model type was examined during <a href="/DSM_book/pages/dsm_cont/sspfs/rf/">the continuous variable prediction methods section</a>.
It can also be used for categorical variables. Some useful extractor
functions like <code class="highlighter-rouge">print</code> and <code class="highlighter-rouge">importance</code> give some useful information
about the model performance.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="data-preparation-">Data Preparation <a id="s-2"></a></h3>

<p>The data to be used for the following modelling exercises are Terron
classes as sampled from the map presented in Malone et al. (2014) .The
sample data contains 1000 entries of which there are 12 different Terron
classes. Before getting into the modeling, we first load in the data and
then perform the covariate layer intersection using the suite of
environmental variables contained in the <code class="highlighter-rouge">hunterCovariates</code> data object
in the <code class="highlighter-rouge">ithir</code> package. The small selection of covariates cover an area
of approximately 220<em>k**m</em><sup>2</sup> at a spatial resolution of 25m.
They include those derived from a DEM: altitude above channel network
(AACN), solar light insolation and terrain wetness index (TWI). Gamma
radiometric data (total count) is also included together with a surface
that depicts soil drainage in form of a continuous index (ranging from 0
to 5). These 5 different covariate layers are stacked together via a
<code class="highlighter-rouge">rasterStack</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># libraries</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">ithir</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span><span class="w">

</span><span class="c1"># load data</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">hvTerronDat</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="p">(</span><span class="n">hunterCovariates</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Transform the <code class="highlighter-rouge">hvTerronDat</code> data to a <code class="highlighter-rouge">SpatialPointsDataFrame</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">hvTerronDat</span><span class="p">)</span><span class="w">

</span><span class="c1">## [1] "x"      "y"      "terron"</span><span class="w">

</span><span class="n">coordinates</span><span class="p">(</span><span class="n">hvTerronDat</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="o">~</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span><span class="w">
</span></code></pre></div></div>

<p>As these data are of the same spatial projection as the
<code class="highlighter-rouge">hunterCovariates</code>, there is no need to perform a coordinate
transformation. So we can perform the intersection immediately.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DSM_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">extract</span><span class="p">(</span><span class="n">hunterCovariates</span><span class="p">,</span><span class="w"> </span><span class="n">hvTerronDat</span><span class="p">,</span><span class="w"> </span><span class="n">sp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"simple"</span><span class="p">)</span><span class="w">
</span><span class="n">DSM_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">)</span><span class="w">

</span><span class="c1">## 'data.frame':    1000 obs. of  8 variables:</span><span class="w">
</span><span class="c1">##  $ x                : num  346535 334760 340910 336460 344510 ...</span><span class="w">
</span><span class="c1">##  $ y                : num  6371940 6375840 6377690 6382040 6378116 ...</span><span class="w">
</span><span class="c1">##  $ terron           : Factor w/ 12 levels "1","2","3","4",..: 3 4 12 5 6 11 3 10 3 5 ...</span><span class="w">
</span><span class="c1">##  $ AACN             : num  37.544 25.564 32.865 0.605 9.516 ...</span><span class="w">
</span><span class="c1">##  $ Drainage.Index   : num  4.72 4.78 2 4.19 4.68 ...</span><span class="w">
</span><span class="c1">##  $ Light.Insolation : num  1690 1736 1712 1712 1677 ...</span><span class="w">
</span><span class="c1">##  $ TWI              : num  11.5 13.8 13.4 18.6 19.8 ...</span><span class="w">
</span><span class="c1">##  $ Gamma.Total.Count: num  380 407 384 388 454 ...</span><span class="w">
</span></code></pre></div></div>

<p>It is always good practice to check to see if any of the observational
data returned any <code class="highlighter-rouge">NA</code> values for any one of the covariates. If there is
<code class="highlighter-rouge">NA</code> values, it indicates that the observational data is outside the
extent of the covariate layers. It is best to remove these observations
from the data set.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">which</span><span class="p">(</span><span class="o">!</span><span class="n">complete.cases</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">))</span><span class="w">

</span><span class="c1">## integer(0)</span><span class="w">

</span><span class="n">DSM_data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DSM_data</span><span class="p">[</span><span class="n">complete.cases</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">),</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre></div></div>

<p>We will also subset the data for an external validation i.e. random hold
back validation. Here 70% of the data for model calibration, leaving the
other 30% for validation.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">655</span><span class="p">)</span><span class="w">

</span><span class="c1"># create calibration/validation datasets</span><span class="w">
</span><span class="n">training</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sample</span><span class="p">(</span><span class="n">nrow</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">),</span><span class="w"> </span><span class="m">0.7</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">DSM_data</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<p><a href="#top">Back to top</a></p>

<h3 id="model-fitting-">Model fitting <a id="s-3"></a></h3>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">randomForest</span><span class="p">)</span><span class="w">

</span><span class="c1">## randomForest 4.6-14</span><span class="w">

</span><span class="c1">## Type rfNews() to see new features/changes/bug fixes.</span><span class="w">

</span><span class="n">hv.RF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">randomForest</span><span class="p">(</span><span class="n">terron</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">AACN</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Drainage.Index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Light.Insolation</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">TWI</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Gamma.Total.Count</span><span class="p">,</span><span class="w"> 
    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data</span><span class="p">[</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="p">],</span><span class="w"> </span><span class="n">ntree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">500</span><span class="p">,</span><span class="w"> </span><span class="n">mtry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Some model summary diagnostics</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Output random forest model diognostics</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">hv.RF</span><span class="p">)</span><span class="w">

</span><span class="c1">## </span><span class="w">
</span><span class="c1">## Call:</span><span class="w">
</span><span class="c1">##  randomForest(formula = terron ~ AACN + Drainage.Index + Light.Insolation +      TWI + Gamma.Total.Count, data = DSM_data[training, ], ntree = 500,      mtry = 5) </span><span class="w">
</span><span class="c1">##                Type of random forest: classification</span><span class="w">
</span><span class="c1">##                      Number of trees: 500</span><span class="w">
</span><span class="c1">## No. of variables tried at each split: 5</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">##         OOB estimate of  error rate: 51.29%</span><span class="w">
</span><span class="c1">## Confusion matrix:</span><span class="w">
</span><span class="c1">##    1 2  3  4  5  6  7  8 9 10 11 12 class.error</span><span class="w">
</span><span class="c1">## 1  4 3  2  7  0  0  0  0 3  0  0  0   0.7894737</span><span class="w">
</span><span class="c1">## 2  4 1  2  1  0  0  0  0 1  0  0  0   0.8888889</span><span class="w">
</span><span class="c1">## 3  1 0 39  7  0  0 17  0 0  0  3  5   0.4583333</span><span class="w">
</span><span class="c1">## 4  6 1  6 16  0  0  6  2 4  0  1  1   0.6279070</span><span class="w">
</span><span class="c1">## 5  0 0  1  1 56 14  3 11 0  4  2  0   0.3913043</span><span class="w">
</span><span class="c1">## 6  0 0  0  0 10 48  0  8 0  1  0  0   0.2835821</span><span class="w">
</span><span class="c1">## 7  0 0 15  3  3  0 75 16 1  3  2  4   0.3852459</span><span class="w">
</span><span class="c1">## 8  0 0  0  4  8  5 18 63 1  5  5  0   0.4220183</span><span class="w">
</span><span class="c1">## 9  2 0  4  5  9  0  7  4 7  3  5  0   0.8478261</span><span class="w">
</span><span class="c1">## 10 1 0  0  0 11  2  7  9 0 19  2  3   0.6481481</span><span class="w">
</span><span class="c1">## 11 0 0 12  1  2  1  3  8 2  1  1  2   0.9696970</span><span class="w">
</span><span class="c1">## 12 0 0  3  0  1  0 14  0 0  3  1 12   0.6470588</span><span class="w">

</span><span class="c1"># output relative importance of each covariate</span><span class="w">
</span><span class="n">importance</span><span class="p">(</span><span class="n">hv.RF</span><span class="p">)</span><span class="w">

</span><span class="c1">##                   MeanDecreaseGini</span><span class="w">
</span><span class="c1">## AACN                     116.97555</span><span class="w">
</span><span class="c1">## Drainage.Index           127.87488</span><span class="w">
</span><span class="c1">## Light.Insolation          85.14123</span><span class="w">
</span><span class="c1">## TWI                      186.51138</span><span class="w">
</span><span class="c1">## Gamma.Total.Count        104.81717</span><span class="w">
</span></code></pre></div></div>

<p>Three types of prediction outputs can be generated from Random Forest
models, and are specified via the <code class="highlighter-rouge">type</code> parameter of the <code class="highlighter-rouge">predict</code>
extractor functions. The different <code class="highlighter-rouge">types</code> are the <code class="highlighter-rouge">response</code> (predicted
class), <code class="highlighter-rouge">prob</code> (class probabilities) or <code class="highlighter-rouge">vote</code> (vote count, which really
just appears to return the probabilities).</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Prediction of classes [first 10 cases]</span><span class="w">
</span><span class="n">predict</span><span class="p">(</span><span class="n">hv.RF</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"response"</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data</span><span class="p">[</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="p">])[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">]</span><span class="w">

</span><span class="c1">## 366  79 946 148 710 729 848  20 923 397 </span><span class="w">
</span><span class="c1">##  12   8   7   5   3   6   5   6  11   5 </span><span class="w">
</span><span class="c1">## Levels: 1 2 3 4 5 6 7 8 9 10 11 12</span><span class="w">

</span><span class="c1"># Class probabilities [first 10 cases]</span><span class="w">
</span><span class="n">predict</span><span class="p">(</span><span class="n">hv.RF</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"prob"</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data</span><span class="p">[</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="p">])[</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1">##         1     2     3     4     5     6     7     8     9    10    11    12</span><span class="w">
</span><span class="c1">## 366 0.006 0.000 0.094 0.010 0.000 0.000 0.024 0.000 0.004 0.002 0.020 0.840</span><span class="w">
</span><span class="c1">## 79  0.000 0.000 0.000 0.002 0.058 0.000 0.140 0.778 0.000 0.012 0.010 0.000</span><span class="w">
</span><span class="c1">## 946 0.000 0.000 0.000 0.018 0.060 0.008 0.614 0.128 0.016 0.112 0.044 0.000</span><span class="w">
</span><span class="c1">## 148 0.000 0.000 0.000 0.000 0.820 0.010 0.000 0.082 0.064 0.022 0.000 0.002</span><span class="w">
</span><span class="c1">## 710 0.002 0.004 0.904 0.012 0.000 0.000 0.048 0.000 0.014 0.000 0.014 0.002</span><span class="w">
</span><span class="c1">## 729 0.000 0.000 0.000 0.000 0.294 0.698 0.000 0.006 0.000 0.002 0.000 0.000</span><span class="w">
</span><span class="c1">## 848 0.000 0.000 0.000 0.000 0.886 0.028 0.000 0.000 0.006 0.080 0.000 0.000</span><span class="w">
</span><span class="c1">## 20  0.000 0.000 0.000 0.000 0.058 0.856 0.000 0.074 0.000 0.002 0.010 0.000</span><span class="w">
</span><span class="c1">## 923 0.000 0.000 0.002 0.040 0.032 0.038 0.040 0.122 0.008 0.040 0.678 0.000</span><span class="w">
</span><span class="c1">## 397 0.004 0.000 0.112 0.008 0.618 0.000 0.030 0.008 0.022 0.074 0.044 0.080</span><span class="w">
</span></code></pre></div></div>

<p><a href="#top">Back to top</a></p>

<h3 id="model-goodness-of-fit">Model goodness of fit<a id="s-4"></a></h3>

<p>From the diagnostics output of the <code class="highlighter-rouge">hv.RF</code> model the confusion matrix is
automatically generated, except it was a different orientation to what
we have been looking for previous examples. This confusion matrix was
performed on what is called the OOB or out-of-bag data i.e. it validates
the model/s dynamically with observations withheld from the model fit.
So lets just evaluate the model as we have done for the previous models.
For calibration:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">C.pred.hv.RF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">hv.RF</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data</span><span class="p">[</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="p">])</span><span class="w">
</span><span class="n">goofcat</span><span class="p">(</span><span class="n">observed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data</span><span class="o">$</span><span class="n">terron</span><span class="p">[</span><span class="n">training</span><span class="p">],</span><span class="w"> </span><span class="n">predicted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">C.pred.hv.RF</span><span class="p">)</span><span class="w">

</span><span class="c1">## $confusion_matrix</span><span class="w">
</span><span class="c1">##     1 2  3  4  5  6   7   8  9 10 11 12</span><span class="w">
</span><span class="c1">## 1  19 0  0  0  0  0   0   0  0  0  0  0</span><span class="w">
</span><span class="c1">## 2   0 9  0  0  0  0   0   0  0  0  0  0</span><span class="w">
</span><span class="c1">## 3   0 0 72  0  0  0   0   0  0  0  0  0</span><span class="w">
</span><span class="c1">## 4   0 0  0 43  0  0   0   0  0  0  0  0</span><span class="w">
</span><span class="c1">## 5   0 0  0  0 92  0   0   0  0  0  0  0</span><span class="w">
</span><span class="c1">## 6   0 0  0  0  0 67   0   0  0  0  0  0</span><span class="w">
</span><span class="c1">## 7   0 0  0  0  0  0 122   0  0  0  0  0</span><span class="w">
</span><span class="c1">## 8   0 0  0  0  0  0   0 109  0  0  0  0</span><span class="w">
</span><span class="c1">## 9   0 0  0  0  0  0   0   0 46  0  0  0</span><span class="w">
</span><span class="c1">## 10  0 0  0  0  0  0   0   0  0 54  0  0</span><span class="w">
</span><span class="c1">## 11  0 0  0  0  0  0   0   0  0  0 33  0</span><span class="w">
</span><span class="c1">## 12  0 0  0  0  0  0   0   0  0  0  0 34</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## $overall_accuracy</span><span class="w">
</span><span class="c1">## [1] 100</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## $producers_accuracy</span><span class="w">
</span><span class="c1">##   1   2   3   4   5   6   7   8   9  10  11  12 </span><span class="w">
</span><span class="c1">## 100 100 100 100 100 100 100 100 100 100 100 100 </span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## $users_accuracy</span><span class="w">
</span><span class="c1">##   1   2   3   4   5   6   7   8   9  10  11  12 </span><span class="w">
</span><span class="c1">## 100 100 100 100 100 100 100 100 100 100 100 100 </span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## $kappa</span><span class="w">
</span><span class="c1">## [1] 1</span><span class="w">
</span></code></pre></div></div>

<p>It seems quite incredible that this particular model is indicating a
100% accuracy. Here it pays to look at the out-of-bag error of the
<code class="highlighter-rouge">hv.RF</code> model for a better indication of the model goodness of fit. For
the random holdback validation:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">V.pred.hv.RF</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">hv.RF</span><span class="p">,</span><span class="w"> </span><span class="n">newdata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data</span><span class="p">[</span><span class="o">-</span><span class="n">training</span><span class="p">,</span><span class="w"> </span><span class="p">])</span><span class="w">
</span><span class="n">goofcat</span><span class="p">(</span><span class="n">observed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">DSM_data</span><span class="o">$</span><span class="n">terron</span><span class="p">[</span><span class="o">-</span><span class="n">training</span><span class="p">],</span><span class="w"> </span><span class="n">predicted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">V.pred.hv.RF</span><span class="p">)</span><span class="w">

</span><span class="c1">## $confusion_matrix</span><span class="w">
</span><span class="c1">##    1 2  3 4  5  6  7  8 9 10 11 12</span><span class="w">
</span><span class="c1">## 1  5 1  0 1  0  0  0  0 0  0  0  0</span><span class="w">
</span><span class="c1">## 2  1 0  0 0  0  0  0  0 0  0  0  0</span><span class="w">
</span><span class="c1">## 3  0 1 18 7  0  0  5  1 4  0  2  1</span><span class="w">
</span><span class="c1">## 4  2 1  0 9  0  1  1  2 1  0  0  0</span><span class="w">
</span><span class="c1">## 5  0 0  0 0 23  3  1  3 5  0  2  0</span><span class="w">
</span><span class="c1">## 6  0 0  0 1  5 18  0  3 1  0  0  0</span><span class="w">
</span><span class="c1">## 7  0 0  4 5  3  0 34  7 2  7  6  4</span><span class="w">
</span><span class="c1">## 8  0 0  0 2  6  2  8 19 2  3  2  2</span><span class="w">
</span><span class="c1">## 9  0 1  0 3  0  0  0  1 4  0  0  0</span><span class="w">
</span><span class="c1">## 10 0 0  1 0  3  1  1  2 0 11  0  1</span><span class="w">
</span><span class="c1">## 11 0 0  2 4  0  0  1  3 1  1  3  0</span><span class="w">
</span><span class="c1">## 12 0 0  2 0  0  0  2  0 0  2  0  3</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## $overall_accuracy</span><span class="w">
</span><span class="c1">## [1] 49</span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## $producers_accuracy</span><span class="w">
</span><span class="c1">##  1  2  3  4  5  6  7  8  9 10 11 12 </span><span class="w">
</span><span class="c1">## 63  0 67 29 58 72 65 47 20 46 20 28 </span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## $users_accuracy</span><span class="w">
</span><span class="c1">##  1  2  3  4  5  6  7  8  9 10 11 12 </span><span class="w">
</span><span class="c1">## 72  0 47 53 63 65 48 42 45 56 20 34 </span><span class="w">
</span><span class="c1">## </span><span class="w">
</span><span class="c1">## $kappa</span><span class="w">
</span><span class="c1">## [1] 0.4224744</span><span class="w">
</span></code></pre></div></div>

<p>So based on the model validation, the Random Forest performs quite
similarly to the other models that were used before, despite a <em>perfect</em>
performance based on the diagnostics of the calibration model.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="apply-model-spatially-">Apply model spatially <a id="s-5"></a></h3>

<p>And finally the map that results from applying the <code class="highlighter-rouge">hv.RF</code> model to the
covariate rasters.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># class prediction</span><span class="w">
</span><span class="n">map.RF.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">covStack</span><span class="p">,</span><span class="w"> </span><span class="n">hv.RF</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"hv_RF_class.tif"</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"GTiff"</span><span class="p">,</span><span class="w"> 
    </span><span class="n">overwrite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">datatype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"INT2S"</span><span class="p">)</span><span class="w">

</span><span class="n">map.RF.c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">map.RF.c</span><span class="p">)</span><span class="w">
</span><span class="n">rat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">map.RF.c</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">rat</span><span class="p">[[</span><span class="s2">"terron"</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"HVT_001"</span><span class="p">,</span><span class="w"> </span><span class="s2">"HVT_002"</span><span class="p">,</span><span class="w"> </span><span class="s2">"HVT_003"</span><span class="p">,</span><span class="w"> </span><span class="s2">"HVT_004"</span><span class="p">,</span><span class="w"> </span><span class="s2">"HVT_005"</span><span class="p">,</span><span class="w"> </span><span class="s2">"HVT_006"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"HVT_007"</span><span class="p">,</span><span class="w"> </span><span class="s2">"HVT_008"</span><span class="p">,</span><span class="w"> </span><span class="s2">"HVT_009"</span><span class="p">,</span><span class="w"> </span><span class="s2">"HVT_010"</span><span class="p">,</span><span class="w"> </span><span class="s2">"HVT_011"</span><span class="p">,</span><span class="w"> </span><span class="s2">"HVT_012"</span><span class="p">)</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">map.RF.c</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rat</span><span class="w">

</span><span class="c1"># plot</span><span class="w">
</span><span class="n">area_colors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#FF0000"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#38A800"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#73DFFF"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#FFEBAF"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#A8A800"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#0070FF"</span><span class="p">,</span><span class="w"> 
    </span><span class="s2">"#FFA77F"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#7AF5CA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#D7B09E"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#CCCCCC"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#B4D79E"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#FFFF00"</span><span class="p">)</span><span class="w">
</span><span class="n">rasterVis</span><span class="o">::</span><span class="n">levelplot</span><span class="p">(</span><span class="n">map.RF.c</span><span class="p">,</span><span class="w"> </span><span class="n">col.regions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">area_colors</span><span class="p">,</span><span class="w"> </span><span class="n">xlab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">ylab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
    <img src="/images/dsm_book/CATrf.png" alt="rconsole" />
    <figcaption> Hunter Valley Terron class map created using random forest model.</figcaption>
</figure>

<p><a href="#top">Back to top</a></p>

<h3 id="references">References</h3>

<p>Malone, B P, P Hughes, A B McBratney, and B Minsany. 2014. “A Model for
the Identification of Terrons in the Lower Hunter Valley, Australia.”
<em>Geoderma Regional</em> 1: 31–47.</p>

      <footer class="entry-meta">
        <span>Updated on <span class="entry-date date published updated"><time datetime="2020-09-13">September 13, 2020</time></span></span>
        <span class="author vcard"><span class="fn">Smart Digital Agriculture</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/DSM_book/pages/dsm_cat/rf/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/DSM_book/pages/dsm_cat/rf/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/DSM_book/pages/dsm_cat/rf/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
    <!--<span>&copy; 2022 Smart Digital Agriculture. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>-->

<footer role="contentinfo">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="mailto:malone.brendan1001@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/brendo1001">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://twitter.com/soilmalone">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Smart Digital Agriculture 2022, All Rights Reserved.</p>
            </div>
        </div>
    </div>
</footer>

</div><!-- /.footer-wrapper -->

<!-- JQuery JavaScript -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>

<!-- Bootstrap Core JavaScript -->
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<!-- Clean Blog JavaScript -->
<script src="/assets/js/clean-blog.min.js"></script>

<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87285093-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


<!-- Math equation support by MathJax -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: {
            equationNumbers: { autoNumber: "all" },
            inlineMath: [['$','$'],['\\(','\\)']],
        },
        "HTML-CSS": {
            availableFonts: ["TeX"],
            preferredFont: "TeX",
        },
    });
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>




</body>
</html>
