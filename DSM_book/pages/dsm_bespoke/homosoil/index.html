<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Homosoils &#8211; Smart Digital Agriculture</title>
<meta name="description" content="">


<!-- Twitter Cards -->
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/">
<meta name="twitter:title" content="Homosoils">
<meta name="twitter:description" content="">
<meta name="twitter:creator" content="@soilmalone">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Homosoils">
<meta property="og:description" content="">
<meta property="og:url" content="/DSM_book/pages/dsm_bespoke/homosoil/">
<meta property="og:site_name" content="Smart Digital Agriculture">

<meta name="google-site-verification" content="googledd99b1430269a639.html">



<link rel="canonical" href="/DSM_book/pages/dsm_bespoke/homosoil/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Smart Digital Agriculture Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<!-- Bootstrap Core CSS -->
<link rel="stylesheet" href="/assets/css/bootstrap.min.css">
<!-- Clean Blog CSS -->
<link rel="stylesheet" href="/assets/css/clean-blog.css">
<!-- HPSTR main CSS -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Custom Fonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Viga|Ubuntu:700' rel='stylesheet' type='text/css'>
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">



<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

</head>

<body id="page" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Smart Digital Agriculture</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                
                    
                    <li><a href="/" >Home</a></li>
                
                    
                    <li><a href="/publications/" >Publications</a></li>
                
                    
                    <li><a href="/software/" >Software</a></li>
                
                    
                    <li><a href="/blog/" >Journal Digests</a></li>
                
                    
                    <li><a href="/UseCases/" >Blog</a></li>
                
                    
                    <li><a href="/DSM_book/" >Using R for Digital Soil Mapping</a></li>
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

<!-- Page Header -->
<header class="intro-header" style="background-image: url('/images/pedometric2017.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
                    <h1>Homosoils</h1>
                    
                        <hr class="small">
                        <span class="subheading"></span>
                    
                </div>
            </div>
        </div>
    </div>
</header>

<!--

-->

<div id="main" role="main">
  <article class="hentry">
    <!--
    <header class="header-title">
      <div class="header-title-wrap">
        <h1 class="entry-title">Homosoils</h1>
        
        <p class="entry-reading-time">
          <i class="fa fa-clock-o"></i>
          
          Reading time ~15 minutes
        </p>
        
      </div>
    </header>
    -->
    <div class="entry-content">
      <h4 id="code">CODE:</h4>
<p><a href="/DSM_book/rcode/P10_digitalSoilAssessment_homosoil.R">Get the code used for this section here</a></p>

<h3 id="digital-land-suitability-assessment">Digital Land Suitability Assessment</h3>

<ul>
  <li><a href="#s-1">Homosoil: a procedure for identifying areas with similar soil forming factors</a></li>
  <li><a href="#s-2">Global climate, lithology and topography data</a></li>
  <li><a href="#s-3">Estimation of similarity</a></li>
  <li><a href="#s-4">The<code class="highlighter-rouge">homosoil</code> function</a></li>
  <li><a href="#s-5">Example of finding soil homologues</a></li>
</ul>

<h3 id="homosoil-a-procedure-for-identifying-areas-with-similar-soil-forming-factors">Homosoil: a procedure for identifying areas with similar soil forming factors.<a id="s-1"></a></h3>

<p><a href="#s-6">jump straight to R example</a></p>

<p>In many places across the world, soil information is difficult to obtain or can even be non-existent. When no detailed maps or soil observations are available in a region of interest, we have to interpolate or extrapolate from other places where such information is not as sparse.</p>

<p>When dealing with global modeling at a coarse resolution, we can interpolate or extrapolate soil observations available from other similar areas (that are geographically close) or by using spatial interpolation or a spatial soil prediction function.</p>

<p>Homosoil, is a concept proposed by Mallavan et al. (2010) which assumes the homology of predictive soil-forming factors between a reference area and the region of interest. These include: climate, parent materials, and physiography of the area.</p>

<p>The <code class="highlighter-rouge">R</code> function, <code class="highlighter-rouge">homosoil</code> was developed to illustrate the concept.</p>

<p>It is relatively simple whereby, given any location (latitude, longitude) in the world, the function will determine other areas in the world that share similar climate, lithology and topography. Shortly we will unpack the function into its elemental components. First we will describe the data and how to measure similarity between sites.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="global-climate-lithology-and-topography-data">Global climate, lithology and topography data.<a id="s-2"></a></h3>

<p>The basis is a global 0.5<sup>∘</sup>×0.5<sup>∘</sup> grid data of climate, topography, and lithology.</p>

<p>For climate, this consists of variables representing long-term mean monthly and seasonal temperature, rainfall, solar radiation and evapotranspiration data.</p>

<p>We also use the DEM representing topography, and lithology, which gives broad information on the parent material.</p>

<p>The climate data come from the ERA-40 reanalysis and Climate Research Unit (CRU) dataset. More details on the datasets are available <a href="https://crudata.uea.ac.uk/cru/data/temperature/">here</a>. For each of the 4 climatic variables (rainfall, temperature, solar radiation and evapotranspiration), we calculated 13 indicators: annual mean, mean for the driest month, mean at the wettest month, annual range, driest quarter mean, wettest quarter mean, coldest quarter mean, hottest quarter mean, lowest ET quarter mean, highest ET quarter mean, darkest quarter mean, lightest quarter mean, and seasonality. From this analysis and including the acquired data, 52 global climatic variables were composed.</p>

<p>The DEM is from the Hydro1k dataset supplied from the <a href="https://www.usgs.gov/centers/eros/science/usgs-eros-arc ive-digital-elevation-hydro1k?qt-science_center_objects=0#qt-s ience_center_objects">USGS</a>, which includes the mean elevation, slope, and compound topgraphic index (CTI).</p>

<p>The <a href="https://www.clisap.de/fileadmin/B-Research/IA/IA5/LIT OMAP/">lithology is from a global digital</a> map which represent the different broad groups of parent materials. The lithology classes are: non- or semi-consolidated sediments, mixed consolidated sediments, silic-clastic sediments, acid volcanic rocks, basic volcanic rocks, complex of metamorphic and igneous rocks, and complex lithology.</p>

<p>This global data is available as a data.frame from the <code class="highlighter-rouge">ithir</code> package.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="estimation-of-similarity">Estimation of similarity<a id="s-3"></a></h3>

<p>The climatic and topographic similarity between two points of the grid is calculated by a Gower similarity measure (Gower (1971)). The Gower distance measures the similarity <em>S</em><sub><em>ij</em></sub> between sites <em>i</em> and <em>j</em>, each with <em>p</em> number of variables, standardized by the range of each variable:</p>

<p><img src="https://latex.codecogs.com/svg.image?\textbf{}S_{ij}=\frac{1}{p}\sum_{k=1}^p\left(1-\frac{\mid{x_{ik}-x_{jk}}\mid}{range&space;k}\right)" alt="gower distance" /></p>

<p>Where <em>p</em> denotes the number of climatic variables, ∣<em>x</em><sub><em>ik</em></sub> − <em>x</em><sub><em>jk</em></sub>∣ represents the absolute difference of climate variables between site <em>i</em> and <em>j</em>. The similarity index has a value between 0 and 1 and is applicable for continuous variables. For categorical variables such as those for lithology, we simply just want to match category for category between sites <em>i</em> and <em>j</em>.</p>

<p>Considering the scale and the resolution of this study and the available global data (0.5<sup>∘</sup> × 0.5<sup>∘</sup>), the climatic factor is probably the most important and reliable soil forming factor. This is inspired by the study of Bui et al. (2006) who showed at continental extent, the state factors of soil formation form a hierarchy of interacting variables, with climate being the most important factor, and different climatic variables dominate in different regions. This is not to say that climate to be the most important factor at all scales. Their results also show that lithology is almost equally important in defining broad scale spatial patterns of soil properties, and shorter-range variability in soil properties appears to be driven more by terrain variables.</p>

<p>In the <code class="highlighter-rouge">homosoil</code> function, the execution sequence is:</p>

<ol>
  <li>Identify homoclimes around the world, and</li>
  <li>Within the homoclime, we find areas with similar lithology
(homolith),</li>
  <li>Within which we then find similar topography (homotop).</li>
</ol>

<p>For climate and topography, we arbitrarily select the top <em>x</em>% of similarity index as areas of homologue. In the following example we select the top <em>15</em>%. So let’s look at the internals of the function before running an example.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="thehomosoil-function-">The<code class="highlighter-rouge">homosoil</code> function <a id="s-1"></a></h3>

<p>Essentially from below we are creating the <code class="highlighter-rouge">homosoil</code> function. This function takes three inputs:</p>

<ol>
  <li><code class="highlighter-rouge">grid.data</code>, which is the global environmental dataset,</li>
  <li>And <code class="highlighter-rouge">recipient.lon</code> and <code class="highlighter-rouge">recipient.lat</code>, which correspond the coordinates of the sites to which we want to find soil homologues.</li>
</ol>

<p>For brevity we will call this the recipient site. Inside the <code class="highlighter-rouge">homosoil</code> function, we first encounter another function which is an encoding of the Gower’s similarity measure as defined previously. This is followed by a number of indexation steps (to make the following steps clearer to implement), where we explicitly make groupings of the data, for example the object <code class="highlighter-rouge">grid.climate</code> is composed of all the global climate information from the <code class="highlighter-rouge">grid.data</code> object. Finally make the object <code class="highlighter-rouge">world.grid</code> which is a <code class="highlighter-rouge">data.frame</code> for putting outputs of the function into. Ultimately this object will get returned at the end of the function execution.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Gower's similarity function</span><span class="w">
</span><span class="n">gower</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">c</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="nf">abs</span><span class="p">(</span><span class="n">c</span><span class="m">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">c</span><span class="m">2</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="w">

</span><span class="c1"># indexation of data groups</span><span class="w">
</span><span class="n">grid.lon</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid_data</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">grid.lat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid_data</span><span class="p">[,</span><span class="w"> </span><span class="m">2</span><span class="p">]</span><span class="w">
</span><span class="n">grid.climate</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid_data</span><span class="p">[,</span><span class="w"> </span><span class="m">3</span><span class="o">:</span><span class="m">54</span><span class="p">]</span><span class="w">  </span><span class="c1"># climate data</span><span class="w">
</span><span class="n">grid.lith</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid_data</span><span class="p">[,</span><span class="w"> </span><span class="m">58</span><span class="p">]</span><span class="w">  </span><span class="c1"># lithology</span><span class="w">
</span><span class="n">grid.topo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid_data</span><span class="p">[,</span><span class="w"> </span><span class="m">55</span><span class="o">:</span><span class="m">57</span><span class="p">]</span><span class="w">  </span><span class="c1"># topography</span><span class="w">

</span><span class="c1"># grid output for making the map at the end</span><span class="w">
</span><span class="n">world.grid</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">grid_data</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"X"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Y"</span><span class="p">)],</span><span class="w"> </span><span class="n">fid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">seq</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">grid_data</span><span class="p">),</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">homologue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">homoclim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">homolith</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">homotop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We then want to find which global grid point is the closest to the recipient site based on the Euclidean distance of the coordinates. We then want to extract the climate, lithological, and topographical data that is recorded for the nearest grid point.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># find the closest recipient point</span><span class="w">
</span><span class="n">dist</span><span class="o">=</span><span class="nf">sqrt</span><span class="p">((</span><span class="n">recipient.lat</span><span class="o">-</span><span class="n">grid.lat</span><span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="o">+</span><span class="p">(</span><span class="n">recipient.lon</span><span class="o">-</span><span class="n">grid.lon</span><span class="p">)</span><span class="o">^</span><span class="p">)</span><span class="w">
</span><span class="n">imin</span><span class="o">=</span><span class="w"> </span><span class="n">which.min</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span><span class="w">
</span><span class="n">ndata</span><span class="o">=</span><span class="nf">dim</span><span class="p">(</span><span class="n">grid.climate</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w">
</span><span class="n">ncol</span><span class="o">=</span><span class="nf">dim</span><span class="p">(</span><span class="n">grid.climate</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w">

</span><span class="c1">#climate, lithology and topography for recipient site</span><span class="w">
</span><span class="n">recipient.climate</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.climate</span><span class="p">[</span><span class="n">imin</span><span class="p">,]</span><span class="w">
</span><span class="n">recipient.lith</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.lith</span><span class="p">[</span><span class="n">imin</span><span class="p">]</span><span class="w">
</span><span class="n">recipient.topo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.topo</span><span class="p">[</span><span class="n">imin</span><span class="p">,]</span><span class="w">
</span></code></pre></div></div>

<p>Starting with climate, we want to estimate Gower’s similarity measure. Firstly we estimate the range of values for each variable. Note the use of the <code class="highlighter-rouge">apply</code> function, which facilitates an efficient way to estimate ranges for each variable. Then using our <code class="highlighter-rouge">gower</code> function, we perform the similarity calculation. This is done for each variable. The <code class="highlighter-rouge">mapply</code> function allows us to do this without the need to use a <code class="highlighter-rouge">for</code> loop. We then take the mean of these values, to which corresponds to the Gower’s similarity measure and which is saved to the object <code class="highlighter-rouge">Sr</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># CALCULATE HOMOCLIME range of climate variables</span><span class="w">
</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">grid.climate</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">range</span><span class="p">)</span><span class="w">
</span><span class="n">rr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rv</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rv</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1"># calculate similarity to all variables in the grid</span><span class="w">
</span><span class="n">S</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">mapply</span><span class="p">(</span><span class="n">gower</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="m">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid.climate</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="m">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recipient.climate</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rr</span><span class="p">))</span><span class="w">

</span><span class="c1"># take the average</span><span class="w">
</span><span class="n">Sr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>We can then determine which grid points are most similar to the recipient site. Here we use an arbitrarily selected cutoff of 0.85 which corresponds to the top <em>15</em>% of grid data similar to the recipient site. Lastly, we save the results of the homocline analysis to the <code class="highlighter-rouge">world.grid</code> object.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># row index for homoclime with top 15% similarity.</span><span class="w">
</span><span class="n">iclim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">Sr</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">Sr</span><span class="p">,</span><span class="w"> </span><span class="m">0.85</span><span class="p">),</span><span class="w"> </span><span class="n">arr.ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">hclim.lith</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.lith</span><span class="p">[</span><span class="n">iclim</span><span class="p">]</span><span class="w">
</span><span class="n">hclim.topo</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">grid.topo</span><span class="p">[</span><span class="n">iclim</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1"># append homoclime info to grid</span><span class="w">
</span><span class="n">world.grid</span><span class="o">$</span><span class="n">homologue</span><span class="p">[</span><span class="n">iclim</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">

</span><span class="c1"># append homoclime info to grid</span><span class="w">
</span><span class="n">world.grid</span><span class="o">$</span><span class="n">homoclim</span><span class="p">[</span><span class="n">iclim</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></code></pre></div></div>

<p>Now we want to find within the areas we have defined as homocline, areas that are homolith. We simply want to find the lithology match between the recipient site and global lithology.</p>

<p>We can do this for the entire globe, and then index those sites that also correspond to homoclines. Again, we save the results of the homolith analysis to the <code class="highlighter-rouge">world.grid</code> object.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># CALCULATE HOMOLITH find within homoclime, areas with homolith</span><span class="w">
</span><span class="n">ilith</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">grid.lith</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">recipient.lith</span><span class="p">,</span><span class="w"> </span><span class="n">arr.ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="n">clim.match</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">world.grid</span><span class="o">$</span><span class="n">homologue</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">climlith.match</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">clim.match</span><span class="p">[</span><span class="n">clim.match</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">ilith</span><span class="p">]</span><span class="w">

</span><span class="c1"># update output grid</span><span class="w">
</span><span class="n">world.grid</span><span class="o">$</span><span class="n">homologue</span><span class="p">[</span><span class="n">climlith.match</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">2</span><span class="w">
</span><span class="n">world.grid</span><span class="o">$</span><span class="n">homolith</span><span class="p">[</span><span class="n">climlith.match</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></code></pre></div></div>

<p>Now we want to find within the areas we have defined as homolith, areas that are homotop. This analysis can be initiated by doing estimating the Gower’s similarity measure for the whole globe. These steps below are just the same as before for the climate date, except now we are using the topographic data. Again we are also using the arbitrarily selected threshold value of <em>15</em>%.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># CALCULATE HOMOTOP range of topographic variables</span><span class="w">
</span><span class="n">rv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">grid.topo</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">range</span><span class="p">)</span><span class="w">
</span><span class="n">rt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rv</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rv</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="p">]</span><span class="w">

</span><span class="c1"># calculate similarity of topographic variables</span><span class="w">
</span><span class="n">Sa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="p">(</span><span class="n">mapply</span><span class="p">(</span><span class="n">gower</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="m">1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid.topo</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="m">2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recipient.topo</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rt</span><span class="p">))</span><span class="w">
</span><span class="n">St</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">Sa</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)</span><span class="w">  </span><span class="c1"># take the average</span><span class="w">

</span><span class="c1"># row index for homotop</span><span class="w">
</span><span class="n">itopo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">St</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">quantile</span><span class="p">(</span><span class="n">St</span><span class="p">,</span><span class="w"> </span><span class="m">0.85</span><span class="p">),</span><span class="w"> </span><span class="n">arr.ind</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Now we want to determine those areas that are homotop within the areas that are homolith.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># matching</span><span class="w">
</span><span class="n">top.match</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">which</span><span class="p">(</span><span class="n">world.grid</span><span class="o">$</span><span class="n">homologue</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">lithtop.match</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">top.match</span><span class="p">[</span><span class="n">top.match</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">itopo</span><span class="p">]</span><span class="w">

</span><span class="c1"># record outputs</span><span class="w">
</span><span class="n">world.grid</span><span class="o">$</span><span class="n">homologue</span><span class="p">[</span><span class="n">lithtop.match</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">3</span><span class="w">
</span><span class="n">world.grid</span><span class="o">$</span><span class="n">homotop</span><span class="p">[</span><span class="n">lithtop.match</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></code></pre></div></div>

<p>That more-or-less completes the homosoil analysis. The last few tasks are to create a raster object of the soil homologues.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># homologue raster object</span><span class="w">
</span><span class="n">r</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">terra</span><span class="o">::</span><span class="n">rast</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">world.grid</span><span class="p">[,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">)],</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"xyz"</span><span class="p">)</span><span class="w">
</span><span class="n">r</span><span class="m">1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.factor</span><span class="p">(</span><span class="n">r</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">rat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">levels</span><span class="p">(</span><span class="n">r</span><span class="m">1</span><span class="p">)[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">rat</span><span class="p">[[</span><span class="s2">"homologue"</span><span class="p">]]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="s2">"homocline"</span><span class="p">,</span><span class="w"> </span><span class="s2">"homolith"</span><span class="p">,</span><span class="w"> </span><span class="s2">"homotop"</span><span class="p">)</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">r</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rat</span><span class="w">
</span></code></pre></div></div>

<p>Followed by directing the <code class="highlighter-rouge">homosoil</code> function to save the relevant outputs which here are the <code class="highlighter-rouge">world.grid</code> object and the raster object of the soil homologues. Then finally we close the function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># return outputs</span><span class="w">
</span><span class="n">retval</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">r</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">world.grid</span><span class="p">)</span><span class="w">
</span><span class="nf">return</span><span class="p">(</span><span class="n">retval</span><span class="p">)}</span><span class="w">
</span></code></pre></div></div>

<p><a href="#top">Back to top</a></p>

<h3 id="example-of-finding-soil-homologues-">Example of finding soil homologues <a id="s-5"></a></h3>

<p>With the <code class="highlighter-rouge">homosoil</code> function now established, let’s put it to use. The coordinates below correspond to a location which here is Canberra, Australia <a id="s-6"></a>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## SITE LOCATION (Canberra, Australia)</span><span class="w">
</span><span class="n">recipient.lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-35.2809</span><span class="w">
</span><span class="n">recipient.lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">149.13</span><span class="w">
</span></code></pre></div></div>

<p>Now we run the <code class="highlighter-rouge">homosoil</code> function.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## RUN FUNCTION</span><span class="w">
</span><span class="n">result</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">homosoil</span><span class="p">(</span><span class="n">grid_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">homosoil_globeDat</span><span class="p">,</span><span class="w"> </span><span class="n">recipient.lon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recipient.lon</span><span class="p">,</span><span class="w"> </span><span class="n">recipient.lat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recipient.lat</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<p>Then we plot the result. Here we want to use the map object that was created inside the <code class="highlighter-rouge">homosoil</code> function. We also specify colors to correspond the non-homologue areas, homoclines, homoliths, and homotops. Because of the hierarchical nature of the homosoil analysis, essentially the homotops are the soil homologues to the recipient site.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># get the map</span><span class="w">
</span><span class="n">map.out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">result</span><span class="p">[[</span><span class="m">1</span><span class="p">]]</span><span class="w">
</span><span class="n">crs</span><span class="p">(</span><span class="n">map.out</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"+init=epsg:4326"</span><span class="w">

</span><span class="c1"># plot</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">map.out</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="o">:</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">desc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"no homologue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"homocline"</span><span class="p">,</span><span class="w"> </span><span class="s2">"homolith"</span><span class="p">,</span><span class="w"> </span><span class="s2">"homotop"</span><span class="p">))</span><span class="w">

</span><span class="n">area_colors</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#f4f4f4"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#969895"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#1CEB15"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#C91601"</span><span class="p">)</span><span class="w">

</span><span class="n">terra</span><span class="o">::</span><span class="n">plot</span><span class="p">(</span><span class="n">map.out</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">area_colors</span><span class="p">,</span><span class="w"> </span><span class="n">plg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">legend</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"no homologue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"homocline"</span><span class="p">,</span><span class="w"> </span><span class="s2">"homolith"</span><span class="p">,</span><span class="w"> </span><span class="s2">"homotop"</span><span class="p">),</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"bottomleft"</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">))</span><span class="w">

</span><span class="c1"># plot point</span><span class="w">
</span><span class="n">pt1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sf</span><span class="o">::</span><span class="n">st_point</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">recipient.lon</span><span class="p">,</span><span class="w"> </span><span class="n">recipient.lat</span><span class="p">))</span><span class="w">
</span><span class="n">plot</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span><span class="w"> </span><span class="n">add</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#040404"</span><span class="p">,</span><span class="w"> </span><span class="n">pch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="n">cex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.8</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure>
    <img src="/images/dsm_book/homosoil_cbr.png" alt="rconsole" />
    <figcaption> Soil homologues of soils at Canberra, Australia (black dot on map).</figcaption>
</figure>

<p>Using the other object that is returned from the <code class="highlighter-rouge">homosoil</code> function (which was the <code class="highlighter-rouge">world.grid</code> data frame used to put the analysis outputs into) we can also map out the homologues individually, for example, we may just want to map the homoclines. It is always fun just to play around with the function to try out different locations and see what corresponding homologues are found. The results might be surprising. However, the resolution of the data is limiting, so please take this into consideration.</p>

<p><a href="#top">Back to top</a></p>

<h3 id="references">References</h3>

<p>Bui, E N, B L Henderson, and K. Viergever. 2006. “Knowledge Discovery from Models of Soil Properties Developed Through Data Mining.” <em>Ecological Modelling</em> 191: 431–46.</p>

<p>Gower, J C. 1971. “A General Coefficient of Similarity and Some of Its Properties.” <em>Biometrics</em> 27: 857–71.</p>

<p>Mallavan, B P, B Minansy, and A B. McBratney. 2010. “Digital Soil Mapping: Bridging Reseach, Environmental Application, and Operation.” In, edited by J L Boettinger, D W Howell, A C Moore, and S. Hartemink A E Kienast-Brown, 137–49. New York: Springer.</p>

<p><a href="#top">Back to top</a></p>

      <footer class="entry-meta">
        <span>Updated on <span class="entry-date date published updated"><time datetime="2023-09-15">September 15, 2023</time></span></span>
        <span class="author vcard"><span class="fn">Smart Digital Agriculture</span></span>
        <div class="social-share">
  <ul class="socialcount socialcount-small inline-list">
    <li class="facebook"><a href="https://www.facebook.com/sharer/sharer.php?u=/DSM_book/pages/dsm_bespoke/homosoil/" title="Share on Facebook"><span class="count"><i class="fa fa-facebook-square"></i> Like</span></a></li>
    <li class="twitter"><a href="https://twitter.com/intent/tweet?text=/DSM_book/pages/dsm_bespoke/homosoil/" title="Share on Twitter"><span class="count"><i class="fa fa-twitter-square"></i> Tweet</span></a></li>
    <li class="googleplus"><a href="https://plus.google.com/share?url=/DSM_book/pages/dsm_bespoke/homosoil/" title="Share on Google Plus"><span class="count"><i class="fa fa-google-plus-square"></i> +1</span></a></li>
  </ul>
</div><!-- /.social-share -->
      </footer>
    </div><!-- /.entry-content -->
    
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
    <!--<span>&copy; 2023 Smart Digital Agriculture. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="http://mademistakes.com/hpstr/" rel="notfollow">HPSTR Theme</a>.</span>-->

<footer role="contentinfo">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="mailto:malone.brendan1001@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://github.com/brendo1001">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a href="https://twitter.com/soilmalone">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Smart Digital Agriculture 2023, All Rights Reserved.</p>
            </div>
        </div>
    </div>
</footer>

</div><!-- /.footer-wrapper -->

<!-- JQuery JavaScript -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>

<!-- Bootstrap Core JavaScript -->
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<!-- Clean Blog JavaScript -->
<script src="/assets/js/clean-blog.min.js"></script>

<script src="/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-87285093-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('send', 'pageview');
</script>


<!-- Math equation support by MathJax -->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        TeX: {
            equationNumbers: { autoNumber: "all" },
            inlineMath: [['$','$'],['\\(','\\)']],
        },
        "HTML-CSS": {
            availableFonts: ["TeX"],
            preferredFont: "TeX",
        },
    });
</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>




</body>
</html>
